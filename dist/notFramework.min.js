function capitalizeFirstLetter(a){"use strict";return a.charAt(0).toUpperCase()+a.slice(1)}function getAttributesStartsWith(a,b){for(var c=a.querySelectorAll(":scope *"),d=[],e=0;e<c.length;e++)for(var f=0,g=c[e].attributes,h=g.length;h>f;f++)if(0===g[f].nodeName.indexOf(b)){d.push(c[e]);break}return d}String.prototype.capitalizeFirstLetter=function(){return this.charAt(0).toUpperCase()+this.slice(1)};var notApp=function(a){this._notOptions=a,this.resources={},this._working={interfaces:{},controllers:{},initController:null,currentController:null,forms:{}}};notApp.prototype.exec=function(){var a=this._notOptions.interfaceManifestURL,b=this._setInterfaceManifest.bind(this);$.ajax({dataType:"json",data:"",url:a,success:b})},notApp.prototype._setInterfaceManifest=function(a){this._notOptions.interfaceManifest=a,this._update()},notApp.prototype._getInterfaceManifest=function(){return this._notOptions.interfaceManifest},notApp.prototype._update=function(){this._updateInterfaces(),this._initFormBuilders(),this._initController(),this.allResourcesReady()&&this.startApp()},notApp.prototype.startApp=function(){this._initRouter()},notApp.prototype._bindController=function(a){var b=new notController(this,a);return b.exec.bind(b)},notApp.prototype._initController=function(){"undefined"!=typeof this._notOptions.initController&&(this._working.initController=new notController(this,this._notOptions.initController),this._working.initController.exec())},notApp.prototype._initRouter=function(){var a={},b=this;$.each(this._notOptions.siteManifest,function(c,d){a[c]=b._bindController(d)}),this._working.router=routie(a)},notApp.prototype._getCurrentController=function(){return this._working.currentController},notApp.prototype._setCurrentController=function(a){return this._working.currentController=a,this},notApp.prototype._updateInterfaces=function(){this._clearInterfaces(),this._notOptions.hasOwnProperty("interfaceManifest")&&$.each(this._notOptions.interfaceManifest,this._initInterface.bind(this))},notApp.prototype._getRecordName=function(a){return"nr"+a.capitalizeFirstLetter()},notApp.prototype._getControllerName=function(a){return"nc"+a.capitalizeFirstLetter()},notApp.prototype._initInterface=function(a,b){console.log(a,b),this._working.interfaces[this._getRecordName(a)]=new notRecord(b)},notApp.prototype.nr=function(a,b){var c=this._notOptions.interfaceManifest.hasOwnProperty(a)?this._notOptions.interfaceManifest[a]:{};return console.log(a,c,b),new notRecord(c,b)},notApp.prototype._getInterfaces=function(){return this._working.interfaces},notApp.prototype._clearInterfaces=function(){this._working.interfaces={}},notApp.prototype._initFormBuilders=function(){this._clearFormBuilders(),this._notOptions.hasOwnProperty("forms")&&$.each(this._notOptions.forms,this._initFormBuilder.bind(this))},notApp.prototype._initFormBuilder=function(a,b){console.log("init form builder",a,b),this._working.forms[a]=new notFormFactory(this,b),this._working.forms[a].init(this.waitThisResource("form",a))},notApp.prototype._getFormBuilders=function(){return this._working.forms},notApp.prototype._clearFormBuilders=function(){this._working.forms={}},notApp.prototype.waitThisResource=function(a,b){return this.resources.hasOwnProperty(a)||(this.resources[a]={}),this.resources[a][b]=!1,this.onResourceReady.bind(this,a,b)},notApp.prototype.onResourceReady=function(a,b){this.resources[a][b]=!0,this.allResourcesReady()&&this.startApp()},notApp.prototype.allResourcesReady=function(){var a,b;for(a in this.resources)for(b in this.resources[a])if(!this.resources[a][b])return!1;return!0},notApp.prototype.getOptions=function(){return this._notOptions.options};var notCommon={extend:function(a,b){for(var c in b)b[c]&&b[c].constructor&&b[c].constructor===Object?(a[c]=a[c]||{},arguments.callee(a[c],b[c])):a[c]=b[c];return a},defineIfNotExists:function(a,b,c){a.hasOwnProperty(b)&&"undefined"!=typeof a[b]&&null!==a[b]||(a[b]=c)}},notEvent={on:function(a,b){notCommon.defineIfNotExists(this,"working",{}),notCommon.defineIfNotExists(this.working,"events",{}),notCommon.defineIfNotExists(this.working.events,a,[]),this.working.events[a].push(b)},trigger:function(a){notCommon.defineIfNotExists(this,"working",{}),notCommon.defineIfNotExists(this.working,"events",{}),notCommon.defineIfNotExists(this.working.events,a,[]);for(var b in this.working.events[a])this.working.events[a][b](arguments[1],arguments[2],arguments[3],arguments[4],arguments[5])},off:function(a,b){if(this.hasOwnProperty("working")&&this.working.hasOwnProperty("events")&&this.working.events.hasOwnProperty(a)){var c=this.working.events[a].indexOf(b);this.working.events[a].splice(c,1)}}};if("undefined"==typeof extend||null===extend)var extend=function(a,b){var c,d={};for(c in a)Object.prototype.hasOwnProperty.call(a,c)&&(d[c]=a[c]);for(c in b)Object.prototype.hasOwnProperty.call(b,c)&&(d[c]=b[c]);return d};var notController=function(a,b){this.app=a,this.ncName="nc"+b.capitalizeFirstLetter(),this.containerSelector=".page-content",this.viewsPostfix=".html",this.renderFromURL=!0;var c=this;$.each(this.app._getInterfaces(),function(a,b){"undefined"!=typeof window[c.ncName]&&(window[c.ncName].prototype[a]=b)})};if(notController.prototype.$render=function(a,b,c,d,e){var f=a.views.hasOwnProperty(b)?a.views[b]:null;if("undefined"!=typeof f&&null!==f){switch(("undefined"==typeof f.place||null===f.place)&&"undefined"!=typeof f.placeId&&null!==f.placeId&&f.placeId.length>0&&(f.place=document.getElementById(f.placeId)),arguments.length){case 4:realCallback=d,realHelpers={};break;default:realHelpers=d,realCallback=e}f.data=c,"undefined"!=typeof f.helpers&&null!==f.helpers&&Object.keys(f.helpers).length>0?f.helpers=extend(f.helpers,realHelpers):f.helpers=realHelpers,a.renderFromURL?("undefined"==typeof f.templateURL||null==f.templateURL||0==f.templateURL.length)&&(f.templateURL=(f.common?a.commonViewsPrefix:a.viewsPrefix)+("undefined"!=typeof f.name&&null!==f.name&&f.name.length>0?f.name:b)+a.viewsPostfix):f.hasOwnProperty("templateName")&&(f.templateName=a.viewsPrefix+f.templateName+a.viewsPostfix),new notTemplate(f).execAndPut(f.place,realCallback)}},notController.prototype.exec=function(a){if(console.log("exec",this,Object.keys(this.__proto__)),"undefined"!=typeof window[this.ncName]){var b=Object.keys(this.__proto__).filter(function(a){return 0===a.indexOf("$")});if(b.length>0)for(var c in b)window[this.ncName].prototype[b[c]]=this.__proto__[b[c]];console.log(new window[this.ncName](this.app,a)),console.log("after new controller")}},"undefined"==typeof extend||null===extend)var extend=function(a,b){var c,d={};for(c in a)Object.prototype.hasOwnProperty.call(a,c)&&(d[c]=a[c]);for(c in b)Object.prototype.hasOwnProperty.call(b,c)&&(d[c]=b[c]);return d};var notFormFactory=function(a,b){return this.app=a,this._params={runActionOnSubmit:!0,removeOnRestore:!0,afterSubmit:function(a){},afterRestore:function(a){}},this.options=b,this._working={template:"",prefix:"notForm_",formElements:{},defaulField:{type:"text",placeholder:"text placeholder"}},this};notFormFactory.prototype.init=function(a){this._working.onReady=a,this.loadTemplate(a)},notFormFactory.prototype.loadTemplate=function(){var a=new XMLHttpRequest;a.open("GET",this.options.templateUrl),a.addEventListener("load",this._setTemplate.bind(this)),a.send()},notFormFactory.prototype._setTemplate=function(a){this._working.template=a.srcElement.responseText,this.parseTemplate(),this._working.onReady()},notFormFactory.prototype.parseTemplate=function(){var a=document.createElement("DIV");a.innerHTML=this._working.template;for(var b=0;b<a.children.length;){var c=a.children[b];if("#text"!==c.nodeName&&c.dataset.hasOwnProperty("notTemplateName")){var d=document.createElement("div");d.appendChild(c),notTemplateCache.setOne(c.dataset.notTemplateName,d)}else b++}},notFormFactory.prototype.build=function(a){var b=new notForm(this.app,this.options);return b.build(a)},notFormFactory.prototype.buildAndPut=function(a,b){var c=new notForm(this.app,this.options);return c.buildAndPut(a,b)};var notForm=function(a,b){return this.app=a,this._params={runActionOnSubmit:!0,removeOnRestore:!0,afterSubmit:function(a){},afterRestore:function(a){}},this.options=b,this._working={block:0,template:"",prefix:"notForm_",formElements:{},defaulField:{type:"text",placeholder:"text placeholder"}},this};notForm.prototype.setOption=function(a,b){return this.options[a]=b,this},notForm.prototype.getOption=function(a){return this.options[a]},notForm.prototype.init=function(a){this._working.onReady=a,this.loadTemplate(a)},notForm.prototype.loadTemplate=function(){var a=new XMLHttpRequest;a.open("GET",this.options.templateUrl),a.addEventListener("load",this._setTemplate.bind(this)),a.send()},notForm.prototype._setTemplate=function(a){this._working.template=a.srcElement.responseText,this.parseTemplate(),this._working.onReady()},notForm.prototype.parseTemplate=function(){var a=document.createElement("DIV");a.innerHTML=this._working.template;for(var b=0;b<a.children.length;){var c=a.children[b];if("#text"!==c.nodeName&&c.dataset.hasOwnProperty("notTemplateName")){var d=document.createElement("div");d.appendChild(c),notTemplateCache.setOne(c.dataset.notTemplateName,d)}else b++}},notForm.prototype._getFormElementTemplate=function(a,b){var c=this._working.prefix+a,d=notTemplateCache.get(c);return d?d:""},notForm.prototype._getFieldValue=function(a,b){var c="",d=b.split(".");if(!(d.length>1))return a&&a.hasOwnProperty(b)&&(c="object"==typeof a[b]&&null!==a[b]&&a[b].hasOwnProperty("_id")?a[b]._id:a[b]),c;var e=d.shift();return a&&a.hasOwnProperty(e)?this._getFieldValue(a[e],d.join(".")):void 0},notForm.prototype.buildFormElement=function(a){var b=this._getParams(),c=this._getFormField(a),d={fieldValue:b&&"undefined"!=typeof b.data&&null!==b.data?this._getFieldValue(b.data,a):"",fieldName:b.modelField?b.modelField+"["+a+"]":a,fieldLabel:c.hasOwnProperty("label")?c.label:"",fieldId:a+"Input",fieldPlaceHolder:c.hasOwnProperty("placeholder")?c.placeholder:"",option:c.hasOwnProperty("option")?c.option:{value:"_id",label:"title"},optionsLib:b.hasOwnProperty(a+"Lib")?b[a+"Lib"]:[]};this._working.params.hasOwnProperty("fields")&&this._working.params.fields.hasOwnProperty(a)&&this._working.params.fields[a].hasOwnProperty("helpers")&&(d=extend(d,this._working.params.fields[a].helpers));var e=new notTemplate({templateElement:this._getFormElementTemplate(c.type,!0),helpers:d,data:b.data}).exec();return this._working.params.hasOwnProperty("fields")&&this._working.params.fields.hasOwnProperty(a)&&this._working.params.fields[a].hasOwnProperty("postProccessor")&&(e=this._working.params.fields[a].postProccessor(e,b.data,d.fieldValue)),e},notForm.prototype.isFieldBlock=function(a){return console.log(typeof a),console.log(a.hasOwnProperty("form")),console.log(a.hasOwnProperty("fields")),"string"!=typeof a&&"object"==typeof a&&(a.hasOwnProperty("form")||a.hasOwnProperty("fields"))},notForm.prototype.getFieldName=function(a){return this.isFieldBlock(a)?(a.hasOwnProperty("name")||(a.name="block"+ ++this._working.block),a.name):a},notForm.prototype.buildFormBlockElement=function(a){var b=this.getRecord()[a.modelField],c=this.app._working.forms.common.build({actionName:"new",title:a.title,scenario:this._getParams().scenario,blockType:a.type,modelName:a.modelName?a.modelName:null,modelField:a.modelField?a.modelField:null,data:a.modelName?this.app.nr(a.modelName,b):this.app.nr(this._getParams().data.getModelName(),b),fields:a.fields?a.fields:null});return[c]},notForm.prototype.setFieldContent=function(a,b){if(b instanceof HTMLCollection)for(var c=[],d=0;d<b.length;d++)c.push(b[d]);else if(Array.isArray(b))for(var c=[],d=0;d<b.length;d++)Array.isArray(b[d])?c=c.concat(b[d]):c.push(b[d]);else c=[b];this._working.formElements[a]=c},notForm.prototype.getFieldContent=function(a){return this._working.formElements.hasOwnProperty(a)?this._working.formElements[a]:[]},notForm.prototype.buildContent=function(a,b){this.isFieldBlock(a)?this.setFieldContent(b,this.buildFormBlockElement(a)):this.setFieldContent(b,this.buildFormElement(b))},notForm.prototype.updateFieldContent=function(a){var b=this.getFieldDefinitionByName(a);if(b){var c=this.getFieldContent(a);this.buildContent(b,a),this.replaceContent(a,c)}},notForm.prototype.getFieldDefinitionByName=function(a){for(var b=this._getScenario().fields,c=0;c<b.length;c++)if(this.isFieldBlock(b[c])){if(b[c].name==a)return b[c]}else if(b[c]==a)return b[c];return null},notForm.prototype.findParent=function(a){return a.length>0?a[0].parentNode:null},notForm.prototype.findPrev=function(a){return a.length>0?a[0].previousSibling:null},notForm.prototype.findNext=function(a){return a.length>0?a[a.length-1].nextSibling:null},notForm.prototype.removeNodes=function(a){for(var b=0;b<a.length;b++)a[b].parentNode.removeChild(a[b])},notForm.prototype.insertBefore=function(a,b){if(a&&b&&b.length>0)for(var c=0;c<b.length;c++)a.parentNode.insertBefore(b[c],a)},notForm.prototype.append=function(a,b){if(a&&b&&b.length>0)for(var c=0;c<b.length;c++)a.appendChild(b[c])},notForm.prototype.replaceContent=function(a,b){var c=this.getFieldContent(a),d=this.findParent(b),e=(this.findPrev(b),this.findNext(b));this.removeNodes(b),d&&(e?this.insertBefore(e,c):this.append(d,c)),this.attachOnCustomActions()},notForm.prototype.buildContents=function(a){var b=0;for(b=0;b<a.length;b++){var c=this.getFieldName(a[b]);this.buildContent(a[b],c)}},notForm.prototype.buildFormWrapper=function(a){var b=this._getParams();return new notTemplate({templateElement:this._getFormElementTemplate(a,!0),data:this._getParams(),helpers:{formTitle:this._getFormTitle(),formId:"Form_"+b.data.getModelName()+"_"+b.actionName,formName:"Form_"+b.data.getModelName()+"_"+b.actionName,formContainerId:"FormContainer_"+b.data.getModelName()+"_"+b.actionName}}).exec()},notForm.prototype.buildBlockWrapper=function(a){var b=this._getParams();return new notTemplate({templateElement:this._getFormElementTemplate(a,!0),data:this._getParams(),helpers:{formTitle:this._getParams().title,blockName:b.modelField,blockId:b.modelField,formId:"Form_"+b.data.getModelName()+"_"+b.actionName,formName:"Form_"+b.data.getModelName()+"_"+b.actionName,formContainerId:"FormContainer_"+b.data.getModelName()+"_"+b.actionName}}).exec()},notForm.prototype.buildBlock=function(){var a="",b=null,c=this._getParams();if(c.fields?b=c.fields:c.data&&c.data.isRecord&&(b=scenario.fields),b){this.buildContents(b),a=this.buildBlockWrapper(c.blockType);var d=this.queryResult(a,':scope [data-role="block"]');console.log(d),this.fillWithContent(a,d)}return this._working.resultForm=a,this._working.block},notForm.prototype.queryResult=function(a,b){if(!(a instanceof HTMLCollection||Array.isArray(a)))return a.querySelector(b);for(var c=0;c<a.length;c++){var d=this.queryResult(a[c],b);if(d)return d}},notForm.prototype.queryResultAll=function(a,b){var c=[];if(a instanceof HTMLCollection||Array.isArray(a)){for(var d=0;d<a.length;d++){var e=this.queryResultAll(a[d],b);e&&e.length>0&&(c=c.concat(e))}return c}var f=a.querySelectorAll(b);return f&&f.length>0?f=Array.prototype.slice.call(f):[]},notForm.prototype.addContent=function(a,b,c){if(a.dataset.hasOwnProperty("target")){var d=this.queryResult(b,':scope [data-role="'+a.dataset.target+'"]');if(d)return void d.appendChild(a)}c&&c instanceof HTMLElement&&c.appendChild(a)},notForm.prototype.fillWithContent=function(a,b){var c=this._getScenario(),d=this._getParams(),e=c?c.fields:d&&d.hasOwnProperty("fields")?d.fields:null;if(e)for(var f=0;f<e.length;f++)for(var g=this.getFieldName(e[f]),h=this.getFieldContent(g),i=0;i<h.length;i++){var j=h[i];j instanceof HTMLElement&&this.addContent(j,a,b)}},notForm.prototype.buildForm=function(){var a="",b=this._getScenario();if("undefined"!=typeof b&&null!==b){this.buildContents(b.fields),a=this.buildFormWrapper(this._getParams().formType);var c=this.queryResult(a,":scope form");this.fillWithContent(a,c)}return this._working.resultForm=a,this._working.resultForm},notForm.prototype._getScenario=function(){var a=this._getAction(),b=this._getParams();return a&&a.hasOwnProperty("form")?b&&b.hasOwnProperty("scenario")&&a.form.hasOwnProperty("scenario")?a.form.scenario.hasOwnProperty(b.scenario)?a.form.scenario[b.scenario]:a.form[b.scenario]:a.form:null},notForm.prototype._getParams=function(){return this._working.params},notForm.prototype._getAction=function(){var a=this._getModel();return a.actions[this._getActionName()]},notForm.prototype._getActionName=function(){return this._getParams().actionName},notForm.prototype._getFormTitle=function(){if(this._getParams().hasOwnProperty("title"))return this._getParams().title;var a=this._getAction();return a.hasOwnProperty("form")&&a.form.hasOwnProperty("title")?a.form.title:"Form title"},notForm.prototype.extractFieldValue=function(a,b){var b=b?b:void 0,c=this._getFormField(a),d=this.queryResult(this._working.resultForm,":scope form");switch(c.type){case"multi":var e=this.queryResultAll(d,':scope [name="'+a+'"] option:checked');if(e){b=[];for(var f=0;f<e.length;f++)console.log(e[f],e[f].value),b.push(e[f].value)}break;case"submit":case"file":break;default:var g=this.queryResult(d,':scope [name="'+a+'"]');g&&"submit"!==g.type&&(console.log(g,g.value),b="checkbox"==g.type?g.checked?g.value:null:g.value)}return b},notForm.prototype.extractBlockValue=function(a,b){for(var b=b?b:{},c=0;c<a.fields.length;c++)fieldName=a.fields[c],field=this._getFormField(fieldName),field.hasOwnProperty("ignore")&&field.ignore||(fieldValue=this.extractFieldValue(a.modelField+"["+fieldName+"]"),"undefined"!=typeof fieldValue&&(b[fieldName]=fieldValue));return b},notForm.prototype._collectFieldsDataToRecord=function(){console.log(this._working.resultForm);var a=this._getParams(),b=a.data,c=this._getScenario(),d=(this._getFormFieldsTypes(),this.queryResult(this._working.resultForm,":scope form")),e=0,f=null,g=null,h=null,i=new FormData(d);for(e=0;e<c.fields.length;e++){if(g=c.fields[e],this.isFieldBlock(g))h=this.extractBlockValue(g,b[g.modelField]);else{if(f=this._getFormField(g),f.hasOwnProperty("ignore")&&f.ignore)continue;h=this.extractFieldValue(g)}"undefined"!=typeof h&&b.setAttr(this.getFieldName(g),h)}b.setModelParam("formData",i)},notForm.prototype._onSubmitSuccess=function(a){var b=this._getParams();this._validationErrorsHandling(),this._removeForm(),b.hasOwnProperty("afterSubmit")?b.afterSubmit(a):null},notForm.prototype._setValidationErrorForField=function(a,b){for(var c=this.getFieldContent(a),d=0;d<c.length;d++){var e=c[d];e.classList.add("has-error");var f=e.querySelector(":scope .help-block");f&&(f.style.WebkitTransition="opacity 1s",f.style.MozTransition="opacity 1s")}},notForm.prototype._setValidationSuccessForField=function(a){for(var b=this.getFieldContent(a),c=0;c<b.length;c++){var d=b[c];d.classList.remove("has-success")}},notForm.prototype._validationErrorsHandling=function(a){var b;for(b in this._working.formElements)"undefined"!=typeof a&&null!==a&&a.hasOwnProperty(b)?this._setValidationErrorForField(b,a[b]):(this._resetValidationErrorForField(b),this._setValidationSuccessForField(b))},notForm.prototype._resetValidationErrorForField=function(a){for(var b=this.getFieldContent(a),c=0;c<b.length;c++){var d=b[c];d.classList.remove("has-error");var e=d.querySelector(":scope .help-block");e&&(e.style.WebkitTransition="opacity 1s",e.style.MozTransition="opacity 1s")}},notForm.prototype.attachOnSubmitAction=function(){if(this._working.resultForm){var a=this.queryResult(this._working.resultForm,":scope form");a&&a.addEventListener("submit",this._submitForm.bind(this))}},notForm.prototype.attachOnCustomActions=function(){if(this._working.resultForm){var a=this.queryResultAll(this._working.resultForm,":scope button"),b=this._getParams();if(a&&a.length>0)for(var c=0;c<a.length;c++)if(a[c].getAttribute("type")&&"button"===a[c].getAttribute("type")){var d=a[c].dataset.notAction;b.hasOwnProperty("actions")&&b.actions.hasOwnProperty(d)&&(a[c].classList.contains("customAction_"+d+"_initialized")||(a[c].addEventListener("click",b.actions[d].bind(this)),a[c].classList.add("customAction_"+d+"_initialized")))}}},notForm.prototype.getRecord=function(){return this._getParams().data},notForm.prototype._submitForm=function(a){return a.stopPropagation(),a.preventDefault(),this._collectFieldsDataToRecord(),this.getRecord()["$"+this._getParams().actionName](this._onSubmitSuccess.bind(this),this._validationErrorsHandling.bind(this)),!1},notForm.prototype.attachRemoveOnRestore=function(){if(this._working.resultForm){var a=this.queryResult(this._working.resultForm,':scope button[type="restore"]');a&&a.addEventListener("click",this._removeForm.bind(this))}},notForm.prototype._removeForm=function(a){return"undefined"!=typeof a&&null!==a&&a.preventDefault(),this.removeNodes(this._working.resultForm),"undefined"!=typeof a&&null!==a&&(this._getParams().hasOwnProperty("afterRestore")?this._getParams().afterRestore(a):null),!1},notForm.prototype._getModelName=function(){if("undefined"!=typeof this._getParams().modelName&&null!==this._getParams().modelName)return this._getParams().modelName;if(this._getParams().hasOwnProperty("data")){var a=this._getParams().data;if("undefined"!=typeof a.modelName&&null!==a.modelName)return a.modelName;if("undefined"!=typeof a.getModelName&&null!==a.getModelName)return a.getModelName()}return null},notForm.prototype._getModel=function(){return this.app._getInterfaceManifest()[this._getModelName()]},notForm.prototype._getFormFieldsTypes=function(){var a=this._getModel();return a&&a.formFieldsTypes?a.formFieldsTypes:null},notForm.prototype._getFormField=function(a){var b=this._getFormFieldsTypes();return"undefined"!=typeof b&&null!==b&&b.hasOwnProperty(a)?b[a]:this._getDefaultField()},notForm.prototype._getDefaultField=function(){return this._working.defaulField},notForm.prototype._clearWorking=function(){this._working.resultForm=null,this._working.formElements={}},notForm.prototype.build=function(a){return this._clearWorking(),this._working.params=extend(this._params,a),console.log("build form ",this._getModelName(),this._getActionName(),this._getFormFieldsTypes(),this._getParams()),this._working.params.hasOwnProperty("blockType")&&this._working.params.blockType?this.buildBlock():this._working.params.hasOwnProperty("formType")&&this._working.params.formType&&this.buildForm(),this.attachOnSubmitAction(),this.attachRemoveOnRestore(),this.attachOnCustomActions(),this._working.resultForm},notForm.prototype.buildAndPut=function(a,b){this.build(a);var c=document.getElementById(b);if(Array.isArray(this._working.resultForm))for(var d=0;d<this._working.resultForm.length;d++)c.appendChild(this._working.resultForm[d]);return this},notForm.prototype.getResult=function(){return this._working.resultForm};var pager={COMPLECTS_PER_PAGE:20,MAX_PAGES_IN_CACHE:2,PAGE_NUMBER_MINIMUM:1,PAGE_NUMBER_MAXIMUM:1,pageNumberCurrent:{left:null,right:null},cacheSize:0,lastDirection:"",apiBlocked:!1,complects:[],apiURL:"",getFilterParams:function(){return{}},nextPage:function(){return this.lastDirection="next",null===this.pageNumberCurrent.right?this.pageNumberCurrent.right=1:this.pageNumberCurrent.right++,this.checkBorders()?!0:(this.pageNumberCurrent.right--,!1)},prevPage:function(){return this.lastDirection="prev",null===this.pageNumberCurrent.left?this.pageNumberCurrent.left=0:this.pageNumberCurrent.left--,this.checkBorders()?!0:(this.pageNumberCurrent.left++,!1)},checkBorders:function(){return this.pageNumberCurrent.right+Math.abs(this.pageNumberCurrent.left)<=this.PAGE_NUMBER_MAXIMUM},addPage:function(a){console.log("recieved",a);var b=!1;switch(this.PAGE_NUMBER_MAXIMUM=parseInt(a.PAGES),this.cacheSize++,this.lastDirection){case"prev":this.complects=a.ELEMENTS.concat(this.complects),this.cacheSize>this.MAX_PAGES_IN_CACHE&&(this.complects=this.complects.slice(0,this.complects.length-this.COMPLECTS_PER_PAGE),this.cacheSize--,b=!0);break;case"next":this.complects=this.complects.concat(a.ELEMENTS),this.cacheSize>this.MAX_PAGES_IN_CACHE&&(this.complects=this.complects.slice(this.COMPLECTS_PER_PAGE,this.complects.length),this.cacheSize--,b=!0)}this.unBlockApi(),console.log("CacheSize:",this.cacheSize),console.log("rebuilded complects:",this.complects),this.onPageLoad(this.complects,a.ELEMENTS,this.lastDirection,b)},getRequestedPagesNumber:function(){switch(this.lastDirection){case"next":return this.pageNumberCurrent.right;case"prev":return this.PAGE_NUMBER_MAXIMUM+this.pageNumberCurrent.left}},apiLoad:function(){var a={filter:this.getFilterParams(),pageSize:this.COMPLECTS_PER_PAGE,pageNum:this.getRequestedPagesNumber()};this.blockApi(),console.log("pager params:",jQuery.param(a)),$.getJSON(this.apiURL+"?"+jQuery.param(a),this.addPage.bind(this))},loadNextPage:function(){!this.apiBlocked&&this.nextPage()&&this.apiLoad()},loadPrevPage:function(){!this.apiBlocked&&this.prevPage()&&this.apiLoad()},unBlockApi:function(){this.apiBlocked=!1},blockApi:function(){this.apiBlocked=!0},reset:function(){this.complects=[],this.cacheSize=0,this.pageNumberCurrent={left:null,right:null},this.lastDirection="",this.apiBlocked=!1},onPageLoad:function(a,b,c){console.log("rebuildElements of complects")}};String.prototype.capitalizeFirstLetter=function(){return this.charAt(0).toUpperCase()+this.slice(1)};var notRecord_stdObjectProps={writable:!1,enumerable:!1},DEFAULT_RECORD_ID_FIELD_NAME="_id",DEFAULT_PAGE_NUMBER=1,DEFAULT_PAGE_SIZE=10,notRecord_Interface={extendObject:function(a,b){"use strict";var c="";for(c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},parseLine:function(a,b,c){"use strict";for(var d=":record[",e="";a.indexOf(d)>-1;){var f=a.indexOf(d),g=d.length,h=a.indexOf("]"),i=(a.indexOf(d),f+g),j=h;if(e=a.slice(i,j),""==e)break;a=a.replace(":record["+e+"]",b.getAttr(e))}return a=a.replace(":modelName",b._notOptions.interfaceManifest.model),a=a.replace(":actionName",c)},getURL:function(a,b,c){"use strict";var d=this.parseLine(a._notOptions.interfaceManifest.url,a,c)+(b.hasOwnProperty("postFix")?this.parseLine(b.postFix,a,c):"");return d},collectRequestData:function(a,b){"use strict";var c={},d=0;if(b.hasOwnProperty("data")&&"undefined"!=typeof b.data&&null!==b.data)for(d=0;d<b.data.length;d++){var e="get"+capitalizeFirstLetter(b.data[d]);e in a&&(c=this.extendObject(c,a[e]()))}var f=new FormData,g=Object.keys(c).length;if(g>0)for(var d in c)f.append(d,c[d]);return"POST"===b.method&&b.hasOwnProperty("formData")&&b.formData?a.getModelParam("formData")||f:b.hasOwnProperty("json")&&b.json?JSON.stringify(c):c},request:function(a,b,c,d){"use strict";console.log("request",b);var e=a._notOptions.interfaceManifest.actions[b],f={cache:!1,contentType:!1,processData:!1},g=this.collectRequestData(a,e),h={method:e.method,data:g,complete:function(b,f){var g=[];b=b.responseJSON,"success"==f?("isArray"in e&&e.isArray?$.each(b,function(b,c){g.push(new notRecord(a._notOptions.interfaceManifest,c))}):g=new notRecord(a._notOptions.interfaceManifest,b),c&&c(g)):"undefined"!=typeof d&&null!==d&&"error"===f&&d(b)}};if(g instanceof FormData)var i=jQuery.extend(h,f);else var i=h;console.log("finalParams",i),$.ajax(this.getURL(a,e,b),i)}},notRecord=function(a,b){if(b&&b.isRecord)return b;if(Array.isArray(b)){for(var c=[],d=0;d<b.length;d++)c.push(new notRecord(a,b[d]));return c}this._notOptions={interfaceManifest:a,filter:{},sorter:{},pageNumber:DEFAULT_PAGE_NUMBER,pageSize:DEFAULT_PAGE_SIZE,fields:[]},"undefined"!=typeof b&&null!==b&&(notRecord_Interface.extendObject(this,b),this._notOptions.fields=Object.keys(b),this._addMetaAttrs());var e=this;return this._notOptions.hasOwnProperty("interfaceManifest")&&"undefined"!=typeof this._notOptions.interfaceManifest&&null!==this._notOptions.interfaceManifest&&this._notOptions.interfaceManifest.hasOwnProperty("actions")&&"undefined"!=typeof this._notOptions.interfaceManifest.actions&&null!==this._notOptions.interfaceManifest.actions&&$.each(this._notOptions.interfaceManifest.actions,function(b,c){this.hasOwnProperty("$"+b)?console.error("interface manifest for ",a.model,' conflict with notRecord property "',"$"+b,'" that alredy exists'):e["$"+b]=function(a,c){console.log("$"+b),notRecord_Interface.request.bind(notRecord_Interface,this,b+"",a,c).call()}}),this};notRecord.prototype.isRecord=!0,Object.defineProperties(notRecord.prototype,{modelName:{get:function(){"use strict";return this._notOptions.interfaceManifest.model}},interfaceManifest:{get:function(){"use strict";return this._notOptions.interfaceManifest}}}),notRecord.prototype.on=notEvent.on,notRecord.prototype.off=notEvent.off,notRecord.prototype.trigger=notEvent.trigger,notRecord.prototype.setModelParam=function(a,b){return this&&this.hasOwnProperty("_notOptions")&&(this._notOptions[a]=b),this},notRecord.prototype.getModelParam=function(a){return this&&this.hasOwnProperty("_notOptions")?this._notOptions[a]:null},notRecord.prototype.getModelName=function(){return this&&this.hasOwnProperty("_notOptions")?this._notOptions.interfaceManifest.model:null},notRecord.prototype.getFieldTitle=function(a){var b=a;return"undefined"!=typeof this._notOptions.interfaceManifest.formFieldsTypes&&this._notOptions.interfaceManifest.formFieldsTypes.hasOwnProperty(a)?this._notOptions.interfaceManifest.formFieldsTypes[a].hasOwnProperty("label")?this._notOptions.interfaceManifest.formFieldsTypes[a].label:this._notOptions.interfaceManifest.formFieldsTypes[a].hasOwnProperty("placeholder")?this._notOptions.interfaceManifest.formFieldsTypes[a].placeholder:this._notOptions.interfaceManifest.formFieldsTypes[a].hasOwnProperty("caption")?this._notOptions.interfaceManifest.formFieldsTypes[a].caption:void 0:b},notRecord.prototype.getFieldTitles=function(){var a=[];if("undefined"!=typeof this._notOptions.interfaceManifest.formFieldsTypes&&this._notOptions.interfaceManifest.formFieldsTypes&&Object.keys(this._notOptions.interfaceManifest.formFieldsTypes).length>0)for(var b=0;b<this.getModelParam("fields").length;b++){var c=this.getModelParam("fields")[b],d={};d[c]=this.getFieldTitle(c),a.push(d)}return a},notRecord.prototype._addMetaAttrs=function(){var a,b,c,d=this.getModelParam("fields");for(a in d)b=d[a],c=typeof this[b],"object"===c&&this._addMetaAttr(b,this[b])},notRecord.prototype._addMetaAttr=function(a,b){var c,d;for(c in b)d=c+"",Object.defineProperty(this,a+c.capitalizeFirstLetter(),{get:function(b){"use strict";return this[a][b]}.bind(this,c)})},notRecord.prototype.setChanged=function(a,b){return this.trigger("onAttrChange_"+a,this,a,b),this.trigger("onAttrChange",this,a,b),this},notRecord.prototype.setAttr=function(a,b){"use strict";var c=this.getModelParam("fields");return-1==c.indexOf(a)&&(c.push(a),this.setModelParam("fields",c)),this[a]=b,"Object"==typeof b&&notRecord.prototype._addMetaAttr(a,b),this.trigger("onAttrChange_"+a,this,a,b),this.trigger("onAttrChange",this,a,b),this},notRecord.prototype.setAttrs=function(a){"use strict";var b;for(b in a)this.setAttr(b,a[b]);return this},notRecord.prototype.getAttrByPath=function(a,b){var c=b.shift();return a.hasOwnProperty(c)?b.length>0?this.getAttrByPath(a[c],b):a[c]:void 0},notRecord.prototype.getAttr=function(a){"use strict";if("undefined"!=typeof a&&null!=a){var b=a.split(".");switch(b.length){case 0:return;case 1:return this.getModelParam("fields").indexOf(a)>-1?this[a]:void 0;default:return this.getAttrByPath(this,b)}}},notRecord.prototype.setFilter=function(a){"use strict";return this.setModelParam("filter",a),this},notRecord.prototype.getFilter=function(){"use strict";return this.getModelParam("filter")},notRecord.prototype.setSorter=function(a){"use strict";return this.setModelParam("sorter",a),this},notRecord.prototype.getSorter=function(){"use strict";return this.getModelParam("sorter")},notRecord.prototype.setPageNumber=function(a){"use strict";return this.setModelParam("pageNumber",a),this},notRecord.prototype.setPageSize=function(a){"use strict";return this.setModelParam("pageSize",a),this},notRecord.prototype.setPager=function(a,b){
"use strict";return this.setModelParam("pageSize",a).setModelParam("pageNumber",b),this},notRecord.prototype.getPager=function(){"use strict";return{pageSize:this.getModelParam("pageSize"),pageNumber:this.getModelParam("pageNumber")}},notRecord.prototype.getRecord=function(){"use strict";var a,b={},c=0,d=this.getModelParam("fields");for(c=0;c<d.length;c++)if(a=d[c],b[a]=this.getAttr(a),b[a]&&b[a].isRecord)b[a]=b[a].getRecord();else if(Array.isArray(b[a])){for(var e=[],f=0;f<b[a].length;f++)b[a][f]&&b[a][f].isRecord?e.push(b[a][f].getRecord()):e.push(b[a][f]);b[a]=e}return b},notRecord.prototype.setFindBy=function(a,b){"use strict";var c={};return c[a]=b,this.setFilter(c)};var notTable=function(a){return this.options=a,this._working={templateNamesPrefix:"notTable_",viewPrefs:{sorter:this.options.sorter?this.options.sorter:{},filter:this.options.filter?this.options.filter:{},pager:{pageSize:this.options.pageSize?this.options.pageSize:this.DEFAULT_PAGE_SIZE,pageNumber:this.options.pageNumber?this.options.pageNumber:this.DEFAULT_PAGE_NUMBER}},filteredData:[]},this.init(),this};notTable.prototype.DEFAULT_PAGE_SIZE=10,notTable.prototype.DEFAULT_PAGE_NUMBER=0,notTable.prototype.init=function(){var a=new XMLHttpRequest;a.open("GET",this.options.templateUrl),a.addEventListener("load",this._setTemplate.bind(this)),a.send()},notTable.prototype._setTemplate=function(a){this._working.template=a.srcElement.responseText,this.parseTemplate(),this.build()},notTable.prototype.parseTemplate=function(){var a=document.createElement("DIV");a.innerHTML=this._working.template,this._working.templateElements={};for(var b=0;b<a.children.length;b++){var c=a.children[b];if(c.nodeType===Node.ELEMENT_NODE&&c.dataset.hasOwnProperty("notTemplateName")){var d=c.dataset.notTemplateName.replace(this._working.templateNamesPrefix,"");this._working.templateElements[d]=c}}return this._working.templateElements},notTable.prototype.build=function(){var a=this;this.views={wrapper:new notView({templateOptions:{templateElement:this._working.templateElements.wrapper,helpers:this.options.helpers},placeToPut:this.options.place,afterExec:function(){a.renderHeader(),a.updateData(),a.renderBody(),a.bindSearch(),a.bindCustomBindings(),a.options.afterExecCallback&&a.options.afterExecCallback()}})},this.renderWrapper()},notTable.prototype.renderWrapper=function(){this.views.wrapper.exec()},notTable.prototype.renderHeader=function(){var a=this.options.place.querySelector(":scope thead tr");if(a)for(var b=0;b<this.options.headerTitles.length;b++){var c=document.createElement("TH");c.innerHTML=this.options.headerTitles[b].title,c.dataset.dataFieldName=this.options.headerTitles[b].field,c.dataset.sortingDirection=0,this.options.headerTitles[b].hasOwnProperty("sortable")&&this.options.headerTitles[b].sortable&&this.attachSortingHandlers(c),a.appendChild(c)}},notTable.prototype.findBody=function(){return this.options.place.querySelector(":scope tbody")},notTable.prototype.clearBody=function(){var a=this.findBody();a&&(a.innerHTML="")},notTable.prototype.renderBody=function(){this.options.onePager||this.clearBody();for(var a=this.getPager().pageSize*this.getPager().pageNumber,b=this.getPager().pageSize*(this.getPager().pageNumber+1),c=this.findBody(),d=a;d<Math.min(b,this._working.filteredData.length);d++)c.appendChild(this.renderRow(this._working.filteredData[d]))},notTable.prototype.refreshBody=function(){var a=this.findBody();if(a){this.clearBody();for(var b=0,c=this.getPager().pageSize*(this.getPager().pageNumber+1),d=b;d<Math.min(c,this._working.filteredData.length);d++)a.appendChild(this.renderRow(this._working.filteredData[d]))}},notTable.prototype.extractAttrValue=function(a,b){var c=void 0;return c=a.getAttr?a.getAttr(b):a[b],"undefined"!=typeof c&&null!==c?c:0},notTable.prototype.renderRow=function(a,b){for(var c=document.createElement("TR"),d=0;d<this.options.headerTitles.length;d++){var e=document.createElement("TD");if(this.options.headerTitles[d].hasOwnProperty("editable")){e.setAttribute("contentEditable",!0);extend({},this.options.headerTitles[d]);e.dataset.field=this.options.headerTitles[d].field,e.dataset.itemId=a[this.options.itemIdField],e.dataset.value=a[e.dataset.field]}if(e.innerHTML=this.options.headerTitles[d].hasOwnProperty("proccessor")?this.options.headerTitles[d].proccessor(a[this.options.headerTitles[d].field],a,b):this.extractAttrValue(a,this.options.headerTitles[d].field),this.options.headerTitles[d].hasOwnProperty("events")&&this.options.headerTitles[d].events)for(var f in this.options.headerTitles[d].events)console.log(f),e.addEventListener(f,this.options.headerTitles[d].events[f],!1);c.appendChild(e)}return this.options.hasOwnProperty("procRow")?this.options.procRow(c,a):c},notTable.prototype.attachSortingHandlers=function(a){var b=this;a.addEventListener("click",function(a){return a.preventDefault(),b.changeSortingOptions(this),!1}),a.style.cursor="pointer"},notTable.prototype.changeSortingOptions=function(a){if(0===parseInt(a.dataset.sortingDirection)?a.dataset.sortingDirection=1:a.dataset.sortingDirection=-1*parseInt(a.dataset.sortingDirection),a.parentNode)for(var b=0;b<a.parentNode.children.length;b++)a.parentNode.children[b]!==a&&(a.parentNode.children[b].classList.remove("sorting_asc"),a.parentNode.children[b].classList.remove("sorting_desc"));parseInt(a.dataset.sortingDirection)>0?(a.classList.remove("sorting_desc"),a.classList.add("sorting_asc"),a.setAttribute("aria-sort","ascending")):(a.classList.remove("sorting_asc"),a.classList.add("sorting_desc"),a.setAttribute("aria-sort","descending")),this.setSorter({sortDirection:a.dataset.sortingDirection,sortByField:a.dataset.dataFieldName})},notTable.prototype.setSorter=function(a){this._working.viewPrefs.sorter=a,this.invalidateData(),this.updateData()},notTable.prototype.getSorter=function(){return this._working.viewPrefs.sorter},notTable.prototype.getFilterSearch=function(){return"undefined"!=typeof this.getFilter()&&null!==this.getFilter()&&"undefined"!=typeof this.getFilter().filterSearch&&null!==this.getFilter().filterSearch?this.getFilter().filterSearch.toString():""},notTable.prototype.invalidateData=function(){this.options.liveLoad&&this.options.onePager&&(this.options.data=[],this.resetPager())},notTable.prototype.setFilter=function(a){this._working.viewPrefs.filter=a,this.invalidateData(),this.updateData()},notTable.prototype.getFilter=function(){return this._working.viewPrefs.filter},notTable.prototype.setPager=function(a){this._working.viewPrefs.pager=a,this.updateData()},notTable.prototype.resetPager=function(){this._working.viewPrefs.pager={pageSize:this.options.pageSize?this.options.pageSize:this.DEFAULT_PAGE_SIZE,pageNumber:this.options.pageNumber?this.options.pageNumber:this.DEFAULT_PAGE_NUMBER}},notTable.prototype.getPager=function(a){return this._working.viewPrefs.pager},notTable.prototype.testDataItem=function(a){var b=this.getFilterSearch().toLowerCase();for(var c in a){var d=a[c].toString().toLowerCase();if(d.indexOf(b)>-1)return!0}return!1},notTable.prototype.setUpdating=function(){this._working.updating=!0},notTable.prototype.setUpdated=function(){this._working.updating=!1},notTable.prototype.ifUpdating=function(){return this._working.updating},notTable.prototype.updateData=function(){var a=this;if(this.options.liveLoad&&this.options.notRecord){if(this.ifUpdating())return;this.options.notRecord=this.options.notRecord.setFilter(this.getFilter()).setSorter(this.getSorter()).setPager(this.getPager().pageSize,this.getPager().pageNumber),this.setUpdating(),this.options.notRecord.$list(function(b){console.log("$list for table",b),a.options.data=a.options.data.concat(b),a.proccessData(),a.refreshBody(),a.setUpdated()})}else this.proccessData(),this.refreshBody()},notTable.prototype.proccessData=function(){var a=this,b=this.getFilter();"undefined"!=typeof b&&null!==b&&"undefined"!=typeof b.filterSearch&&null!==b.filterSearch&&b.filterSearch.length>0?this._working.filteredData=this.options.data.filter(a.testDataItem.bind(a)):this._working.filteredData=this.options.data;var c=a.getSorter();"undefined"!=typeof c&&null!==c&&this._working.filteredData.sort(function(b,d){return isNaN(a.extractAttrValue(b,c.fieldName))?a.extractAttrValue(b,c.fieldName).localeCompare(a.extractAttrValue(d,c.fieldName))*-c.direction:(a.extractAttrValue(b,c.fieldName)<a.extractAttrValue(d,c.fieldName)?1:-1)*c.direction})},notTable.prototype.bindSearch=function(){var a=this.options.place.querySelectorAll('input[name="search"]')[0];if(a){var b=this,c=function(a){return b.setFilter({filterSearch:this.value}),!0};a.addEventListener("keyup",c),a.addEventListener("enter",c)}},notTable.prototype.bindCustomBindings=function(){if(this.options.hasOwnProperty("bindings")&&this.options.bindings){var a=this;setTimeout(function(){for(var b in a.options.bindings)for(var c=a.options.place.querySelectorAll(b),d=0;d<c.length;d++){var e=c[d];for(var f in a.options.bindings[b])e.addEventListener(f,a.options.bindings[b][f])}},200)}},notTable.prototype.setData=function(){},notTable.prototype.getData=function(){},notTable.prototype.addData=function(){},notTable.prototype.loadNext=function(){this._working.viewPrefs.pager.pageNumber++,this.updateData()},notTable.prototype.setParam=function(a,b){this.options[a]=b};var notTemplateCache={cache:{},loading:[],onLoad:null,load:function(a){this.loading=[];for(var b in a)this.loadOne(b,a[b])},loadOne:function(a,b,c){this.loading.push(a);var d=new XMLHttpRequest;d.open("GET",b),d.addEventListener("load",function(d){this.loading.indexOf(a)>-1&&this.loading.splice(this.loading.indexOf(a),1);var e=document.createElement("DIV");e.dataset.notTemplateName=a,e.dataset.notTemplateURL=b,e.innerHTML=d.srcElement.responseText,this.setOne(a,e),c&&c(a,b,e),0===this.loading.length&&this.onLoad&&this.onLoad()}.bind(this)),d.send()},setOne:function(a,b){this.cache[a]=b},get:function(a){return this.cache.hasOwnProperty(a)?this.cache[a].cloneNode(!0):null},getByURL:function(a){for(var b in this.cache)if(this.cache[b].dataset.notTemplateURL==a)return this.get(b);return null}},notTemplate=function(a){var b=function(){var b=null;if(a.hasOwnProperty("templateElement"))b=a.templateElement;else if(a.templateCache){var c=notTemplateCache.get(a.templateCache);c&&(b=c.cloneNode(!0))}else a.hasOwnProperty("templateName")&&document.querySelector('[data-not-template-name="'+a.templateName+'"]')&&(b=document.querySelector('[data-not-template-name="'+a.templateName+'"]').cloneNode(!0));return b};return this._notOptions={proccessorIndexAttributeName:"data-not-template-proccindex",proccessorExpressionPrefix:"data-not-",proccessorExpressionSeparator:"-",proccessorExpressionConditionPostfix:"if",attributeExpressionItemPrefix:":",attributeExpressionHelpersPrefix:"::",attributeExpressionFunctionPostfix:"()",attributeExpressionDefaultResult:"",repeat:a.data instanceof Array,data:a.data,place:a.place,selector:a.templateName,template:a.hasOwnProperty("template")?a.template:null,templateCache:a.hasOwnProperty("templateCache")?a.templateCache:null,templateElement:b(),templateURL:a.hasOwnProperty("templateURL")?a.templateURL:null,helpers:a.helpers},this._working={proccessors:[],templateHTML:a.hasOwnProperty("template")?a.template:"",templateLoaded:this._notOptions.templateElement?!0:!1,result:[],currentEl:null,currentItem:null,currentIndex:null},this};notTemplate.prototype._exec=function(){if(this._notOptions.repeat)this._proccessItems();else{this._working.currentIndex=0,this._working.currentItem=this._notOptions.data,this._proccessItem();for(var a=0;a<this._working.currentEl.children.length;a++)this._working.result.push(this._working.currentEl.children[a])}},notTemplate.prototype.exec=function(a){var b=this;if(b._working.templateLoaded){if(b._exec(),"undefined"==typeof a)return b._working.result;a(b._working.result)}else{var c=notTemplateCache.getByURL(b._notOptions.templateURL);c?(b._working.templateLoaded=!0,b._notOptions.templateElement=c,b._exec(),"undefined"!=typeof a&&a(b._working.result)):notTemplateCache.loadOne(b._notOptions.templateURL,b._notOptions.templateURL,function(c,d,e){b._working.templateLoaded=!0,b._notOptions.templateElement=e,b._exec(),"undefined"!=typeof a&&a(b._working.result)})}},notTemplate.prototype.execAndPut=function(a,b){this.exec(function(c){a instanceof HTMLElement&&(a.innerHTML="",this.insert(a,c)),"undefined"!=typeof b&&b(c)}.bind(this))},notTemplate.prototype.insert=function(a,b){var c=0;if(a instanceof HTMLElement)if(b instanceof HTMLCollection)for(;b.length&&++c<1e4;)this.insert(a,b[0]);else if(Array.isArray(b))for(var d=0;d<b.length;d++)this.insert(a,b[d]);else b instanceof HTMLElement&&a.appendChild(b,a);return a},notTemplate.prototype.insertBefore=function(a,b){var c=0;if(a instanceof HTMLElement)if(b instanceof HTMLCollection)for(;b.length&&++c<1e4;)this.insertBefore(a,b[0]);else if(Array.isArray(b))for(var d=0;d<b.length;d++)this.insertBefore(a,b[d]);else b instanceof HTMLElement&&a.parentNode.insertBefore(b,a);return a},notTemplate.prototype.execAndAdd=function(a,b){this.exec(function(c){this.insert(a,c),"undefined"!=typeof b&&b(c)}.bind(this))},notTemplate.prototype.execAndReplace=function(a,b){this.exec(function(c){this.insertBefore(a,c),a.parentNode.removeChild(a),"undefined"!=typeof b&&b(c)}.bind(this))},notTemplate.prototype._proccessItems=function(){var a;for(this._working.result=[],a=0;a<this._notOptions.data.length;a++){this._working.currentIndex=a,this._working.currentItem=this._notOptions.data[a],this._proccessItem();for(var b=0;b<this._working.currentEl.children.length;b++)this._working.result.push(this._working.currentEl.children[b])}},notTemplate.prototype._getTemplateElement=function(){if(null===this._notOptions.template)return this._notOptions.templateElement.cloneNode(!0);var a=document.createElement("div");return a.innerHTML=this._notOptions.template,a},notTemplate.prototype._proccessItem=function(){this._working.currentEl=this._getTemplateElement(),this._findAllTemplateProccessors(),this._execProccessorsOnCurrent()},notTemplate.prototype._findAllTemplateProccessors=function(){"use strict";var a=getAttributesStartsWith(this._working.currentEl,this._notOptions.proccessorExpressionPrefix),b=null;for(this._working.proccessors=[],b=0;b<a.length;b++)for(var c=0,d=a[b].attributes,e=d.length;e>c;c++)if(0===d[c].nodeName.indexOf(this._notOptions.proccessorExpressionPrefix)){var f=this._parseProccessorExpression(d[c].nodeName);f.element=a[b],f.proccessorExpression=d[c].nodeName,f.attributeExpression=d[c].value,this._working.proccessors.push(f)}},notTemplate.prototype._parseProccessorExpression=function(a){var b={params:[],proccessorName:"",ifCondition:!1};return a=a.replace(this._notOptions.proccessorExpressionPrefix,""),a.indexOf(this._notOptions.proccessorExpressionConditionPostfix)===a.length-this._notOptions.proccessorExpressionConditionPostfix.length&&(b.ifCondition=!0,a=a.replace(this._notOptions.proccessorExpressionSeparator+this._notOptions.proccessorExpressionConditionPostfix,"")),b.params=a.split(this._notOptions.proccessorExpressionSeparator),b.proccessorName=b.params[0],b.params=b.params.slice(1),b},notTemplate.prototype._getAttributeExpressionResult=function(a,b,c){"use strict";var d=null,e=0===a.indexOf(this._notOptions.attributeExpressionHelpersPrefix),f=0===a.indexOf(this._notOptions.attributeExpressionItemPrefix),g=a.indexOf(this._notOptions.attributeExpressionFunctionPostfix)===a.length-2,h=e?this._notOptions.helpers:b,i=a.replace(this._notOptions.attributeExpressionHelpersPrefix,"").replace(this._notOptions.attributeExpressionItemPrefix,"").replace(this._notOptions.attributeExpressionFunctionPostfix,"");return!e&&!f||null==h||"undefined"==typeof h?a:(g?d=h.hasOwnProperty(i)?h[i](b,c):this._notOptions.attributeExpressionDefaultResult:(console.log(h[i]),d="undefined"!=typeof h[i]?h[i]:this._notOptions.attributeExpressionDefaultResult),d)},notTemplate.prototype._execProccessorsOnCurrent=function(){var a;for(console.log("exec proccessors on current"),a=0;a<this._working.proccessors.length;a++)if(this._working.proccessors[a].attributeResult=this._getAttributeExpressionResult(this._working.proccessors[a].attributeExpression,this._working.currentItem,this._working.currentIndex),this.proccessorsLib.hasOwnProperty(this._working.proccessors[a].proccessorName)){var b=this._working.proccessors[a].proccessorName;this.proccessorsLib[b](this._working.proccessors[a],this._working.currentItem,this._notOptions.helpers),this._working.proccessors[a].element.removeAttribute(this._working.proccessors[a].proccessorExpression)}},notTemplate.prototype.proccessorsLib={provider:function(a,b,c){"use strict";a.params.indexOf("capitalize")>-1&&(a.attributeResult=a.attributeResult.toUpperCase()),a.element.innerHTML=a.attributeResult;var d=a.params.indexOf("live");if(d>-1&&d==a.params.length-1){var e=null;if(0===a.attributeExpression.indexOf("::")){var f=a.attributeExpression.replace("::","");c.hasOwnProperty(f)&&c[f]&&(e=c[f])}else if(b.on&&0===a.attributeExpression.indexOf(":"))var e=a.attributeExpression.replace(":","");e&&b.on("onAttrChange_"+e,function(){console.log("on attr change",arguments);var c=b.getAttr(e);a.params.indexOf("capitalize")>-1&&(c=c.toUpperCase()),a.element.innerHTML!=c&&(a.element.innerHTML=c)})}},options:function(a,b,c){"use strict";var d=0,e=null,f="value",g="name",h="value";if(2===a.params.length&&(g=a.params[0],f=a.params[1]),"undefined"!=typeof c&&null!==c&&c.hasOwnProperty("option")&&(g=c.option.label,f=c.option.value),3===a.params.length&&(h=a.params[2]),"undefined"!=typeof c&&null!==c&&c.hasOwnProperty("fieldPlaceHolder")&&c.hasOwnProperty("fieldPlaceHolderDefault")&&c.fieldPlaceHolderDefault&&(e=document.createElement("option"),e.setAttribute("value",""),e.textContent=c.fieldPlaceHolder,a.element.appendChild(e)),"undefined"!=typeof b&&null!==b)for(d=0;d<a.attributeResult.length;d++)e=document.createElement("option"),e.setAttribute("value",a.attributeResult[d][f]),e.textContent=a.attributeResult[d][g],"[object Array]"===Object.prototype.toString.call(b[h])?b[h].indexOf(a.attributeResult[d][f])>-1&&e.setAttribute("selected",!0):b[h]===a.attributeResult[d][f]&&e.setAttribute("selected",!0),a.element.appendChild(e)},attr:function(a,b,c){"use strict";a.element.setAttribute(a.params[0],a.attributeResult);var d=a.params.indexOf("live");if(d>-1&&d==a.params.length-1){var e=null;if(0===a.attributeExpression.indexOf("::")){var f=a.attributeExpression.replace("::","");c.hasOwnProperty(f)&&c[f]&&(e=c[f])}else if(b.on&&0===a.attributeExpression.indexOf(":"))var e=a.attributeExpression.replace(":","");e&&b.isRecord&&b.on("onAttrChange_"+e,function(){console.log("on attr change",arguments);var c=b.getAttr(e);a.element.getAttribute(a.params[0])!=c&&a.element.setAttribute(a.params[0],c)})}},addclass:function(a,b,c){a.attributeResult&&a.element.classList.add(a.params[0])},value:function(a,b,c){console.log("value",a),a.element.setAttribute("value",a.attributeResult);var d=a.params.indexOf("live");if(d>-1&&d==a.params.length-1){var e=null;if(0===a.attributeExpression.indexOf("::")){var f=a.attributeExpression.replace("::","");c.hasOwnProperty(f)&&c[f]&&(e=c[f])}else if(b.on&&0===a.attributeExpression.indexOf(":"))var e=a.attributeExpression.replace(":","");e&&b.isRecord&&b.on("onAttrChange_"+e,function(){console.log("on attr change",arguments);var c=b.getAttr(e);a.element.value!=c&&(a.element.value=c)})}},checked:function(a,b,c){console.log("checked",a),a.element.setAttribute("checked",a.attributeResult),console.log(a)},bind:function(a,b,c){console.log("bind",a),a.element.addEventListener(a.params[0],function(d){return d.stopImmediatePropagation(),d.preventDefault(),"undefined"!=typeof c&&null!==c&&c.hasOwnProperty(a.attributeResult)&&c[a.attributeResult](b,d),!1})},subtemplate:function(a,b,c){for(var d=function(a){return a.charAt(0).toUpperCase()+a.slice(1)},e=a.params[0],f=1;f<a.params.length&&("live"!=a.params[f]||f+1!=a.params.length);f++)e+=d(a.params[f]);var g=(new notTemplate({templateCache:e,templateName:e,helpers:c,data:a.attributeResult}).execAndReplace(a.element),a.params.indexOf("live"));if(g>-1&&g==a.params.length-1){var h=c.hasOwnProperty("fieldName")?c.fieldName:null;h&&b.isRecord&&b.on("onAttrChange_"+h,function(){console.log("on attr change",arguments)})}},live:function(a,b,c){var d=["change","keyup"];console.log("live",a);for(var e=0;e<d.length;e++)a.element.addEventListener(d[e],function(d){var e=!0;return"undefined"!=typeof c&&null!==c&&c.hasOwnProperty("validators")&&c.validators.hasOwnProperty(a.attributeResult)&&(e=c.validators[a.attributeResult](a,b,d)),e&&b.isRecord&&(b.setAttr?"checkbox"==a.element.type?b.setAttr(a.attributeResult,a.element.checked?a.element.value:void 0):b.getAttr(a.attributeResult)==a.element.value?e=!1:b.setAttr(a.attributeResult,a.element.value):"checkbox"==a.element.type?b.setAttr(a.attributeResult,a.element.checked?a.element.value:void 0):b[a.attributeResult]==a.element.value?e=!1:b[a.attributeResult]=a.element.value),e})}};var notView=function(a){return this.options=a,this};notView.prototype.getTemplateOptions=function(){var a={};return"undefined"!=typeof this.options.templateOptions&&null!==this.options.templateOptions?this.options.templateOptions:a},notView.prototype.getPlaceToPut=function(){return"undefined"!=typeof this.options.placeToPut&&null!==this.options.placeToPut?this.options.placeToPut:document.body},notView.prototype.getAfterExecCallback=function(a){var b=function(){console.log("default view after exec callback")};return"undefined"!=typeof a&&null!==a?a:"undefined"!=typeof this.options.afterExec&&null!==this.options.afterExec?this.options.afterExec:b},notView.prototype.exec=function(a){new notTemplate(this.getTemplateOptions()).execAndPut(this.getPlaceToPut(),this.getAfterExecCallback(a))},notView.prototype.setParam=function(a,b){return this.options[a]=b,this},notView.prototype.setTemplateParam=function(a,b){return this.options.templateOptions[a]=b,this},notView.prototype.getParam=function(a){return this.options.hasOwnProperty(a)?this.options[a]:void 0},notView.prototype.getParams=function(){return this.options};
//# sourceMappingURL=sourcemap.map