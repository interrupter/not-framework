!function(e){"use strict";var t={addHost:function(e){return this.get("host")+e},addProtocol:function(e){return this.get("protocol")+e},preloadImages:function(e,t){for(var n in e)for(var r in t)if(e[n].hasOwnProperty(t[r])){var i=new Image;i.setAttribute("crossOrigin","anonymous"),i.src=0===e[n][t[r]].indexOf("//")?this.addProtocol(e[n][t[r]]):e[n][t[r]]}},putFile:function(e){var t=this;return new Promise(function(n,r){var i=new XMLHttpRequest;i.upload?(e.onProgress&&i.upload.addEventListener("progress",e.onProgress,!1),i.responseType="json",i.onreadystatechange=function(){4==i.readyState&&(200==i.status?n(i.response):r(i.response))},i.withCredentials=!0,i.open("PUT",e.url,!0),i.setRequestHeader("SessionID",t.getSessionID()),i.setRequestHeader("Content-Type",e.file.type),i.setRequestHeader("X_FILENAME",encodeURIComponent(e.file.name)),i.send(e.file)):r()})},requestJSON:function(e,t,n){var r=this;return new Promise(function(i,a){var o=new XMLHttpRequest;o.open(e,t,!0),o.setRequestHeader("SessionID",r.getSessionID()),o.setRequestHeader("Content-Type","application/json; charset=utf-8"),o.responseType="json",o.withCredentials=!0,o.onload=function(){var e=o.status;200==e?i(o.response):a(o.response)};var s=function(){return a(o.status)};o.onerror=s,o.ontimeout=s,o.send(n)})},getJSON:function(e,t){var n=this;return new Promise(function(r,i){var a=new XMLHttpRequest;a.open("get",e,!0),a.setRequestHeader("SessionID",n.getSessionID()),a.setRequestHeader("Content-Type","application/json; charset=utf-8"),a.responseType="json",a.withCredentials=!0,a.onload=function(){var e=a.status;200==e?r(a.response):i(a.response)};var o=function(){return i(a.status)};a.onerror=o,a.ontimeout=o,a.send(t)})},postJSON:function(e,t){var n=this;return new Promise(function(r,i){var a=new XMLHttpRequest;a.open("POST",e),a.setRequestHeader("SessionID",n.getSessionID()),a.setRequestHeader("Content-Type","application/json; charset=utf-8"),a.responseType="json",a.withCredentials=!0,a.onload=function(){var e=a.status;200==e?r(a.response):i(a.response)};var o=function(){return i(a.status)};a.onerror=o,a.ontimeout=o,a.send(t)})},putJSON:function(e,t){var n=this;return new Promise(function(r,i){var a=new XMLHttpRequest;a.open("PUT",e),a.setRequestHeader("SessionID",n.getSessionID()),a.setRequestHeader("Content-Type","application/json; charset=utf-8"),a.responseType="json",a.withCredentials=!0,a.onload=function(){var e=a.status;200==e?r(a.response):i(a.response)};var o=function(){return i(a.status)};a.onerror=o,a.ontimeout=o,a.send(t)})},deleteJSON:function(e,t){var n=this;return new Promise(function(r,i){var a=new XMLHttpRequest;a.open("DELETE",e),a.setRequestHeader("SessionID",n.getSessionID()),a.setRequestHeader("Content-Type","application/json; charset=utf-8"),a.responseType="json",a.withCredentials=!0,a.onload=function(){var e=a.status;200==e?r(a.response):i(a.response)};var o=function(){return i(a.status)};a.onerror=o,a.ontimeout=o,a.send(t)})},getHTML:function(e,t){var n=this;return new Promise(function(r,i){var a=new XMLHttpRequest;a.open("get",e,!0),a.setRequestHeader("SessionID",n.getSessionID()),a.responseType="text",a.withCredentials=!0,a.onload=function(){var e=a.status;200===parseInt(e)?r(a.responseText):i(a.responseText)};var o=function(e){return i(e)};a.onerror=o,a.ontimeout=o,a.send(t)})},getSessionID:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"SessionID";return this.getCookie(e)},getCookie:function(e){var t="; "+document.cookie,n=t.split("; "+e+"=");return 2==n.length?n.pop().split(";").shift():null}},n="console",r={error:function(){if(!notFramework.notCommon.get("production")){var e;(e=window[n]).error.apply(e,arguments)}},log:function(){if(!notFramework.notCommon.get("production")){var e;(e=window[n]).log.apply(e,arguments)}},report:function(){if(!notFramework.notCommon.get("production")){var e;(e=window[n]).error.apply(e,arguments)}},trace:function(){if(!notFramework.notCommon.get("production")){var e;(e=window[n]).trace.apply(e,arguments)}},mute:function(){this.register("production",!0)}},i=Symbol("MANAGER"),a={getAPI:function(){return this.getManager().getAPI()},setManager:function(e){this[i]=e},getManager:function(){return this[i]}},o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},h=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},p=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)},c={extend:function(e,t){var n,r={};for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);for(n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n]);return r},completeAssign:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;t>r;r++)n[r-1]=arguments[r];return n.forEach(function(t){var n=Object.keys(t).reduce(function(e,n){return e[n]=Object.getOwnPropertyDescriptor(t,n),e},{});Object.getOwnPropertySymbols(t).forEach(function(e){var r=Object.getOwnPropertyDescriptor(t,e);r.enumerable&&(n[e]=r)}),Object.defineProperties(e,n)}),e},extendWith:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])},containsObj:function(e,t){for(var n in t)if(t.hasOwnProperty(n)&&(!e.hasOwnProperty(n)||e[n]!==t[n]))return!1;return!0},filter:function(e,t){return t&&e?this.containsObj(e,t):!0},findIconByFilter:function(e,t){for(var n=[],r=0;r<e.length;r++)this.filter(e[r].getData(),t)&&n.push(e[r]);return n},equalObj:function(e,t){var n;for(n in e)if("undefined"==typeof t[n])return!1;for(n in e)if(e[n])switch(o(e[n])){case"object":if(!this.equal(e[n],t[n]))return!1;break;case"function":if("undefined"==typeof t[n]||"equals"!=n&&e[n].toString()!=t[n].toString())return!1;break;default:if(e[n]!=t[n])return!1}else if(t[n])return!1;for(n in t)if("undefined"==typeof e[n])return!1;return!0},defineIfNotExists:function(e,t,n){e.hasOwnProperty(t)||(e[t]=n)},deepMerge:function(e,t){return jQuery.extend(!0,{},e,t)},registry:{},register:function(e,t){this.registry[e]=t},get:function(e){return this.registry.hasOwnProperty(e)?this.registry[e]:null},moveItem:function(e,t,n){if(n>=e.length)for(var r=n-e.length;r--+1;)e.push(void 0);e.splice(n,0,e.splice(t,1)[0])}},g={capitalizeFirstLetter:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},lowerFirstLetter:function(e){return e.charAt(0).toLowerCase()+e.slice(1)}},f={pipe:function(e,t){var n=void 0,r=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var u=o.value;n=u(n||e)}}catch(l){i=!0,a=l}finally{try{!r&&s["return"]&&s["return"]()}finally{if(i)throw a}}return n}},d={getAttributesStartsWith:function(e,t){for(var n=e.querySelectorAll("*"),r=[],i=0;i<n.length;i++)for(var a=0,o=n[i].attributes,s=o.length;s>a;a++)if(0===o[a].nodeName.indexOf(t)){r.push(n[i]);break}return r}},v={startApp:function(e){document.addEventListener("DOMContentLoaded",e)},getApp:function(){return this.get("app")}},y=Object.assign({},c);y.extendWith(t),y.extendWith(g),y.extendWith(r),y.extendWith(a),y.extendWith(f),y.extendWith(d),y.extendWith(v);var m="{",k="}",O=".",b=":",P="::",w="()",S=10,R=function(){function e(){return s(this,e),this}return u(e,[{key:"findNextSubPath",value:function(e){for(var t="",n=!1,r=0;r<e.length;r++)if(e[r]===m)n=!0,t="";else if(e[r]===k&&n){if(n)return t}else t+=e[r];return n?t:null}},{key:"replaceSubPath",value:function(e,t,n){for(var r=m+t+k;e.indexOf(r)>-1;)e=e.replace(r,n);return e}},{key:"parseSubs",value:function(e,t,n){for(var r=this.findNextSubPath(e),i=void 0,a=0;r&&(i=this.getValueByPath(r.indexOf(P)>-1?n:t,r,t,n),e=this.replaceSubPath(e,r,i),a++,!(a>S));)r=this.findNextSubPath(e);return e}},{key:"get",value:function(e,t,n){switch(e){case b:return t;case P:return n}return e=this.parseSubs(e,t,n),this.getValueByPath(e.indexOf(P)>-1?n:t,e,t,n)}},{key:"set",value:function(e,t,n,r){3===arguments.length&&(r=n,n=void 0);for(var i=this.findNextSubPath(e),a=void 0,o=0;i&&(a=this.getValueByPath(i.indexOf(P)>-1?n:t,i,t,n),e=this.replaceSubPath(e,i,a),!(o>S));)i=this.findNextSubPath(e);this.setValueByPath(t,e,r),t.isRecord&&this.normilizePath(e).length>1&&t.trigger("change",t,e,r)}},{key:"unset",value:function(e,t,n){this.set(e,t,n,null)}},{key:"parsePathStep",value:function(e,t,n){var r=null;if(0===e.indexOf(P)&&n){if(r=e.replace(P,""),r.indexOf(w)!==r.length-2)return n[r];if(r=e.replace(w,""),n.hasOwnProperty(r))return n[r](t,void 0)}else if(0===e.indexOf(b)&&t){if(r=e.replace(b,""),r.indexOf(w)!==r.length-2)return t[r];if(r=e.replace(w,""),t.hasOwnProperty(r))return t[r](t,void 0)}return e}},{key:"parsePath",value:function(e,t,n){Array.isArray(e)||(e=e.split(O));for(var r=0;r<e.length;r++)e[r]=this.parsePathStep(e[r],t,n);return e}},{key:"normilizePath",value:function(e){if(Array.isArray(e))return e;for(;e.indexOf(b)>-1;)e=e.replace(b,"");return e.split(O)}},{key:"ifFullSubPath",value:function(e,t){if(e.length<t.length)return!1;for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}},{key:"getValueByPath",value:function(e,t,n,r){t=this.normilizePath(t);var i=t.shift(),a=i.indexOf(w)>-1;if(a&&(i=i.replace(w,"")),"object"===("undefined"==typeof e?"undefined":o(e))&&"undefined"!=typeof e[i]&&null!==e[i]){var s=a?e[i]({item:n,helpers:r}):e[i];return t.length>0?this.getValueByPath(s,t,n,r):s}}},{key:"setValueByPath",value:function(e,t,n){t=this.normilizePath(t);var r=t.shift();t.length>0?(e.hasOwnProperty(r)||(e[r]={}),this.setValueByPath(e[r],t,n)):e[r]=n}},{key:"join",value:function(){var e=Array.prototype.slice.call(arguments);return e.join(O)}}]),e}(),E=new R,D=Symbol("init"),W=Symbol("events"),A=Symbol("data"),x=Symbol("working"),N=Symbol("options"),C=function(){function e(t){return s(this,e),this[W]={},this[A]={},this[x]={},this[N]={},this[D](t),this}return u(e,[{key:D,value:function(e){if(e||(e={}),e.hasOwnProperty("events")){var t=!0,n=!1,r=void 0;try{for(var i,a=e.events[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;this.on.apply(this,p(o))}}catch(s){n=!0,r=s}finally{try{!t&&a["return"]&&a["return"]()}finally{if(n)throw r}}}e.hasOwnProperty("data")&&this.setData(e.data),e.hasOwnProperty("working")&&this.setWorking(e.working),e.hasOwnProperty("options")&&this.setOptions(e.options)}},{key:"setCommon",value:function(e,t){switch(t.length){case 1:e=t[0];break;case 2:E.set(t[0],e,void 0,t[1])}return this}},{key:"getCommon",value:function(e,t){switch(t.length){case 1:return E.get(t[0],e);case 2:var n=E.get(t[0],e);return void 0===n?t[1]:n;default:return e}}},{key:"setData",value:function(){return 1===arguments.length?this[A]=arguments[0]:this.setCommon(this.getData(),arguments),this.trigger("change"),this}},{key:"getData",value:function(){return this.getCommon(this[A],arguments)}},{key:"setOptions",value:function(){return 1===arguments.length?this[N]=arguments[0]:this.setCommon(this.getOptions(),arguments),this}},{key:"getOptions",value:function(){return this.getCommon(this[N],arguments)}},{key:"setWorking",value:function(){return 1===arguments.length?this[x]=arguments[0]:this.setCommon(this.getWorking(),arguments),this}},{key:"getWorking",value:function(){return this.getCommon(this[x],arguments)}},{key:"on",value:function(e,t,n){var r=this;return Array.isArray(e)||(e=[e]),Array.isArray(t)||(t=[t]),e.forEach(function(e){y.defineIfNotExists(r[W],e,[]),r[W][e].push({callbacks:t,once:n,count:0})}),this}},{key:"trigger",value:function(){var e=Array.from(arguments),t=e.shift();Array.isArray(t)||(t=[t]);for(var n=0;n<t.length;n++){var r=t[n];if(this[W].hasOwnProperty(r))for(var i=0;i<this[W][r].length;i++){var a=this[W][r][i];a.once&&this.off(r,a.callbacks);for(var o=0;o<a.callbacks.length;o++){var s;(s=a.callbacks)[o].apply(s,p(e))}}}return this}},{key:"off",value:function(e,t){Array.isArray(e)||(e=[e]),Array.isArray(t)||(t=[t]);for(var n=0;n<e.length;n++){for(var r=e[n],i=-1,a=0;a<this[W][r].length;a++){var o=this[W][r][a];if(-1===i&&t===o.callbacks){i=a;break}}i>-1&&this[W][r].splice(i,1)}return this}},{key:"offAll",value:function(){for(var e=Object.keys(this[W]),t=0;t<e.length;t++)this[W].hasOwnProperty(e[t])&&delete this[W][e[t]]}},{key:"log",value:function(){!y.get("production")&&y.log&&y.log.apply(y,[this.getWorking("name")].concat(Array.prototype.slice.call(arguments)))}},{key:"info",value:function(){!y.get("production")&&y.info&&y.info.apply(y,[this.getWorking("name")].concat(Array.prototype.slice.call(arguments)))}},{key:"error",value:function(){!y.get("production")&&y.error&&y.error.apply(y,[this.getWorking("name")].concat(Array.prototype.slice.call(arguments)))}},{key:"report",value:function(){y.report&&y.report.apply(y,[this.getWorking("name")].concat(Array.prototype.slice.call(arguments)))}}]),e}(),T=Symbol("history"),L=Symbol("hash"),_=50,F=function(e){function t(){var e;s(this,t);var n=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.setWorking({routes:[],mode:T,root:"/",initialized:!1}),e=n,h(n,e)}return l(t,e),u(t,[{key:"history",value:function(){this.setWorking("mode",T)}},{key:"hash",value:function(){this.setWorking("mode",L)}},{key:"setRoot",value:function(e){return this.setWorking("root",e?"/"+this.clearSlashes(e)+"/":"/"),this}},{key:"clearSlashes",value:function(e){return e.toString().replace(/\/$/,"").replace(/^\//,"")}},{key:"add",value:function(e,t){"function"==typeof e&&(t=e,e="");var n={re:e,handler:t};return this.getWorking("routes").push(n),this}},{key:"addList",value:function(e){for(var t in e)this.add(t,e[t]);return this}},{key:"remove",value:function(e){for(var t,n=0;n<this.getWorking("routes").length,t=this.getWorking("routes")[n];n++)if(t.handler===e||t.re===e)return this.getWorking("routes").splice(n,1),this;return this}},{key:"flush",value:function(){return this.setWorking({routes:[],mode:T,root:"/"}),this}},{key:"isInitialized",value:function(){return this.getWorking("initialized")}},{key:"setInitialized",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!0;return this.setWorking("initialized",e)}},{key:"getFragment",value:function(){var e="";if(this.getWorking("mode")===T){if(!location)return"";e=this.clearSlashes(decodeURI(location.pathname+location.search)),e=e.replace(/\?(.*)$/,""),e="/"!=this.getWorking("root")?e.replace(this.getWorking("root"),""):e}else{if(!window)return"";var t=window.location.href.match(/#(.*)$/);e=t?t[1]:""}return this.clearSlashes(e)}},{key:"checkLocation",value:function(){var e=this.getWorking("current"),t=this.getFragment(),n=this.isInitialized();e===t&&n||(this.setWorking("current",t),this.check(t),this.setInitialized())}},{key:"hrefClick",value:function(){}},{key:"getRoot",value:function(){return""}},{key:"listen",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_;return this.setWorking("current","notInitialized"),clearInterval(this.getWorking("interval")),this.setWorking("interval",setInterval(this.checkLocation.bind(this),e)),window.addEventListener("popstate",this.hrefClick.bind(this)),this}},{key:"check",value:function(e){for(var t=e||this.getFragment(),n=0;n<this.getWorking("routes").length;n++){var r=this.getWorking("root")+this.getWorking("routes")[n].re,i=this.clearSlashes(decodeURI(r)),a=t.match(i);if(a)return a.shift(),this.getWorking("routes")[n].handler.apply(this.host||{},a),this}return this}},{key:"navigate",value:function(e){switch(e=e?e:"",this.getWorking("mode")){case T:history.pushState(null,null,this.getFullRoute(e));break;case L:window.location.href.match(/#(.*)$/),window.location.href=window.location.href.replace(/#(.*)$/,"")+"#"+e}return this}},{key:"getFullRoute",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this.getWorking("root")+this.clearSlashes(e)}},{key:"getAllLinks",value:function(){for(var e=document.body.querySelectorAll("a"),t=[],n=0;n<e.length;n++)for(var r=0,i=e[n].attributes,a=i.length;a>r;r++)if(0===i[r].nodeName.indexOf("n-href")){t.push(e[n]);break}return t}},{key:"reRouteExisted",value:function(){for(var e=this.getAllLinks(),t=0;t<e.length;t++)this.initRerouting(e[t],e[t].getAttribute("n-href"));return this}},{key:"initRerouting",value:function(e,t){var n=this;if(!e.notRouterInitialized){var r=this.getFullRoute(t);e.setAttribute("href",r),e.addEventListener("click",function(e){return e.preventDefault(),n.navigate(t),!1}),e.notRouterInitialized=!0}return this}}]),t}(C),I=new F,M={rps:50,protocol:"http",host:"localhost",port:9e3},j=function(){function e(t){return s(this,e),this.quee=[],this["int"]=null,this.requestsPerSecond=t||5,this}return u(e,[{key:"run",value:function(){this["int"]=window.setInterval(this.check.bind(this),1e3/this.requestsPerSecond)}},{key:"check",value:function(){if(!this.inProgress&&this.quee.length>0){this.inProgress=!0;var e=this.quee.shift();e()}}},{key:"next",value:function(){this.inProgress=!1}},{key:"add",value:function(e){this.quee.push(e)}},{key:"pause",value:function(){window.clearInterval(this["int"])}},{key:"resume",value:function(){this.run()}}]),e}(),q=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2e3;return s(this,e),this.data={},this.ttl=parseInt(t),this}return u(e,[{key:"add",value:function(e,t,n){return E.set(E.join(e,t),{data:n,validTill:(new Date).getTime()+this.ttl},{},this.data),this}},{key:"find",value:function(e,t){var n=E.get(E.join(e,t),this.data);return n&&n.validTill<(new Date).getTime()&&n.data?n.data:void E.unset(E.join(e,t),this.data)}}]),e}(),U=function(e){function t(e){var n;s(this,t);var r=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.setOptions(y.extend(M,e)),r.quee=new j(r.getOptions("rps")),r.quee.run(),r.cache=new q,n=r,h(r,n)}return l(t,e),u(t,[{key:"makeUrl",value:function(e){return e.join("/")}},{key:"queeRequest",value:function(e,t,n,r,i,a){var o=this;return new Promise(function(s,u){o.quee.add(o.makeRequest.bind(o,e,t,n,r,function(e){i&&i(e),s(e)},function(e){a&&a(e),u(e)}))})}},{key:"makeRequest",value:function(e,t,n,r,i,a){var o=this;y.requestJSON(e,t,r).then(function(e){o.quee.next(),i&&i(e)})["catch"](function(e){o.quee.next(),a&&a(e)})}},{key:"update",value:function(e,t,n){var r=this;return new Promise(function(i,a){var o=e.getId(),s=e.getModelName(),u=r.makeUrl([r.getOptions("base"),s,o]),l=e.getJSON();r.quee.add(r.makeRequest.bind(r,"post",u,o,l,function(e){t&&t(e),i(e)},function(e){n&&n(e),a(e)}))})}},{key:"put",value:function(e,t,n){var r=this;return new Promise(function(i,a){var o=e.getModelName(),s=e.getJSON(),u=r.makeUrl([r.getOptions("base"),o]);r.quee.add(r.makeRequest.bind(r,"put",u,null,s,function(e){t&&t(e),i(e)},function(e){n&&n(e),a(e)}))})}},{key:"get",value:function(e,t,n){var r=this;return new Promise(function(i,a){var o=e.getId(),s=e.getModelName(),u=r.makeUrl([r.getOptions("base"),s,o]);r.quee.add(r.makeRequest.bind(r,"get",u,o,null,function(e){t&&t(e),i(e)},function(e){n&&n(e),a(e)}))})}},{key:"list",value:function(e,t,n){var r=this;return new Promise(function(i,a){var o=e.getModelName(),s=r.makeUrl([r.getOptions("base"),o]);r.quee.add(r.makeRequest.bind(r,"get",s,null,null,function(e){t&&t(e),i(e)},function(e){n&&n(e),a(e)}))})}},{key:"delete",value:function(e,t,n){var r=this;return new Promise(function(i,a){var o=e.getId(),s=e.getModelName(),u=r.makeUrl([r.getOptions("base"),s,o]);r.quee.add(r.makeRequest.bind(r,"delete",u,o,null,function(e){t&&t(e),i(e)},function(e){n&&n(e),a(e)}))})}}]),t}(C),B=function(e){function t(){return s(this,t),h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return l(t,e),t}(C),z="n-",H="nt",Q="-",X="if",V="not_component_",J="not_part_",G="place",K="placeAfter",Y={PROCESSOR_EXPRESSION_PREFIX:z,TEMPLATE_TAG:H,PROCESSOR_EXPRESSION_SEPARATOR:Q,PROCESSOR_EXPRESSION_CONDITION_POSTFIX:X,DEFAULT_PLACER:G,COMPONENT_ID_PREFIX:V,PART_ID_PREFIX:J,DEFAULT_PLACER_LOOP:K},Z=Symbol("cache"),ee=function(e){function t(){var e;s(this,t);var n=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n[Z]={},n.setWorking("loading",[]),n.hideTemplates(),n.register(),e=n,h(n,e)}return l(t,e),u(t,[{key:"hideTemplates",value:function(){var e=document.createElement("style");e.innerHTML=Y.TEMPLATE_TAG+"{display: none;}",document.head.appendChild(e)}},{key:"register",value:function(){y.register("templateCache",this)}},{key:"load",value:function(e){this.setWorking("loading",[]);for(var t in e)this.loadOne(t,e[t])}},{key:"loadOne",value:function(e,t,n){var r=new XMLHttpRequest;r.open("GET",t),r.addEventListener("load",function(r){var i=document.createElement("DIV");i.dataset.notTemplateName=e,i.dataset.notTemplateURL=t,i.innerHTML=r.srcElement.responseText,this.setOne(e,i),n&&n(e,t,i)}.bind(this)),r.send()}},{key:"ifAllLoaded",value:function(){0===this.getWorking("loading").length&&this.trigger("loaded")}},{key:"setOne",value:function(e,t){t instanceof HTMLElement?this[Z][e]=t:this.addFromText(e,t)}},{key:"get",value:function(e){return this[Z].hasOwnProperty(e)?this[Z][e].cloneNode(!0):null}},{key:"getNames",value:function(){return Object.keys(this[Z])}},{key:"getByURL",value:function(e){for(var t in this[Z])if(this[Z][t].src==e)return this.get(t);return null}},{key:"setLoaded",value:function(e){var t=this.getWorking("loading").indexOf(e);t>-1&&this.getWorking("loading").splice(t,1),this.getWorking("loaded").push("key")}},{key:"wrap",value:function(e,t,n){var r=document.createElement(Y.TEMPLATE_TAG);return r.name=e,r.src=t,r.innerHTML=n,r}},{key:"parseLib",value:function(e){var t=document.createElement("div"),n={};t.innerHTML=e;for(var r=t.querySelectorAll(Y.TEMPLATE_TAG),i=0;i<r.length;i++){var a=r[i];a.parentNode===t&&a.attributes.name&&a.attributes.name.value&&(n[a.attributes.name.value]=a)}return n}},{key:"addLib",value:function(e){for(var t in e)this.setOne(t,e[t]);return this}},{key:"addFromURL",value:function(e,t){var n=this,r=arguments;return new Promise(function(i,a){n.get(e)?i(n.get(e)):y.getHTML(t).then(function(r){var a=n.wrap(e,t,r);n.setOne(e,a),i(n.get(e))})["catch"](function(){y.error("error loading template",e,t),a.apply(void 0,r)})})}},{key:"addLibFromURL",value:function(e){var t=this,n=arguments;return new Promise(function(r,i){y.getHTML(e).then(function(e){var n=t.parseLib(e);t.addLib(n),r(n)})["catch"](function(t){y.error("error loading templates lib",e,t),i.apply(void 0,n)})})}},{key:"addFromDocument",value:function(e){var t="string"==typeof e?document.querySelector(e):e;return t.attributes.name&&t.attributes.name.value&&t.tagName.toLowerCase()===Y.TEMPLATE_TAG.toLowerCase()&&this.setOne(t.attributes.name.value,t),this}},{key:"addFromText",value:function(e,t){var n=this.wrap(e,"",t);return this.setOne(e,n),this}}]),t}(C),te=new ee,ne=["_id","id","ID"],re={},ie=1,ae=10,oe=Symbol("returnToRoot"),se=Symbol("proxy"),ue=Symbol("interface"),le=Symbol("change"),he=Symbol("change.nested"),pe=["getAttr","getAttrs","isProperty","isRecord","getManifest","setAttr","setAttrs","getData","setData","getJSON","on","off","trigger"],ce=["getActionsCount","getActions","setFindBy","resetFilter","setFilter","getFilter","setSorter","getSorter","resetSorter","setPageNumber","setPageSize","setPager","resetPager","getPager"],ge="$",fe=function(e){function t(e){var n;s(this,t);var r=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{}));return r.manifest=e,n=r,h(r,n)}return l(t,e),u(t,[{key:"parseLine",value:function(e,t,n){for(var r=":record[",i="";e.indexOf(r)>-1;){var a=e.indexOf(r),o=r.length,s=e.indexOf("]"),u=a+o,l=s;if(i=e.slice(u,l),""==i)break;e=e.replace(":record["+i+"]",t.getAttr(i))}return e=e.replace(":modelName",this.manifest.model),e=e.replace(":actionName",n)}},{key:"getURL",value:function(e,t,n){var r=this.parseLine(this.manifest.url,e,n)+(t.hasOwnProperty("postFix")?this.parseLine(t.postFix,e,n):"");return r}},{key:"getID",value:function(e,t){var n=void 0,r=ne,i=["",this.manifest.model];t.hasOwnProperty("index")&&t.index&&(r=[t.index].concat(ne));var a=!0,o=!1,s=void 0;try{for(var u,l=i[Symbol.iterator]();!(a=(u=l.next()).done);a=!0){var h=u.value,p=!0,c=!1,g=void 0;try{for(var f,d=r[Symbol.iterator]();!(p=(f=d.next()).done);p=!0){var v=f.value;if(e.hasOwnProperty(h+v)){n=e[h+v];break}}}catch(y){c=!0,g=y}finally{try{!p&&d["return"]&&d["return"]()}finally{if(c)throw g}}}}catch(y){o=!0,s=y}finally{try{!a&&l["return"]&&l["return"]()}finally{if(o)throw s}}return n}},{key:"getActionsCount",value:function(){return this.getActions()?Object.keys(this.getActions()).length:0}},{key:"getActions",value:function(){return this.manifest&&this.manifest.actions?this.manifest.actions:{}}},{key:"setFindBy",value:function(e,t){var n={};return n[e]=t,this.setFilter(n)}},{key:"setFilter",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:re;return this.setWorking("filter",e)}},{key:"resetFilter",value:function(){return this.setFilter({})}},{key:"getFilter",value:function(){return this.getWorking("filter")}},{key:"setSorter",value:function(e){return this.setWorking("sorter",e)}},{key:"getSorter",value:function(){return this.getWorking("sorter")}},{key:"setPageNumber",value:function(e){return this.setWorking("pageNumber",e)}},{key:"setPageSize",value:function(e){return this.setWorking("pageSize",e)}},{key:"setPager",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ae,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ie;return this.setWorking("pageSize",e).setWorking("pageNumber",t)}},{key:"resetPager",value:function(){return this.setPager()}},{key:"getPager",value:function(){return{pageSize:this.getWorking("pageSize"),pageNumber:this.getWorking("pageNumber")}}},{key:"getModelName",value:function(){return this&&this.manifest?this.manifest.model:null}},{key:"getActionData",value:function(e){return this.getActions()&&this.getActions()[e]?this.getActions()[e]:null}},{key:"collectRequestData",value:function(e){var t={};if(e.hasOwnProperty("data")&&Array.isArray(e.data))for(var n=0;n<e.data.length;n++){var r="get"+y.capitalizeFirstLetter(e.data[n]);this[r]&&"function"==typeof this[r]&&(t=y.extend(t,this[r]()))}return t}},{key:"encodeRequest",value:function(e){var t="?";for(var n in e)t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n])+"&";return t}},{key:"request",value:function(e,t){var n=this,r=this.getActionData(t),i=this.collectRequestData(r),a=this.encodeRequest(i),o=this.getID(e,r,t),s=this.getURL(e,r,t);return y.getAPI().queeRequest(r.method,s+a,o,JSON.stringify(e.getData())).then(function(e){return n.afterSuccessRequest(e,r)})}},{key:"afterSuccessRequest",value:function(e,t){if(this&&t&&t.hasOwnProperty("isArray")&&t.isArray)for(var n=0;n<e.length;n++)e[n]=new me(this.manifest,e[n]);else e=new me(this.manifest,e);return e}}]),t}(C),de=function(e){return{get:function(e,t,n){if("isProxy"===t)return!0;var r=e;return"symbol"===("undefined"==typeof t?"undefined":o(t))?this[t]&&(r=this):(Object.keys(this).indexOf(t)>-1||pe.indexOf(t)>-1)&&(r=this),Reflect.get(r,t,n)}.bind(e),set:function(e,t,n){if(Object.keys(this).indexOf(t)>-1)throw new Error('Invalid attempt to private "'+t+'" property');var r=n;"object"===("undefined"==typeof n?"undefined":o(n))&&(r=new ve(this.getOptions("getRoot"),E.join(this.getOptions("path"),t),n));var i=Reflect.set(e,t,r);return this.trigger("change",e,t,r),i}.bind(e)}},ve=function(e){function t(e,n,r){var i;s(this,t);var a=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if("undefined"==typeof r||null===r){var o;return o=r,h(a,o)}if(r&&(r.isProxy||r.isProperty)){var u;return u=r,h(a,u)}return a.setOptions({getRoot:e,path:n}),a[se]=new Proxy(r,de(a)),a.setData(r),a.isProperty=!0,a.on("change",a[oe].bind(a)),i=a[se],h(a,i)}return l(t,e),u(t,[{key:oe,value:function(e,t,n){var r=this.getOptions("getRoot")();r.trigger("change.nested",this[se],this.getOptions("path"),t,n)}}]),t}(C),ye=function(e){return{get:function(e,t,n){if("isProxy"===t||"isRecord"===t)return!0;var r=e;return"symbol"===("undefined"==typeof t?"undefined":o(t))?this[t]&&(r=this):(Object.keys(this).indexOf(t)>-1||pe.indexOf(t)>-1||ce.indexOf(t)>-1)&&(r=this),Reflect.get(r,t,n)}.bind(e),set:function(e,t,n){if(Object.keys(this).indexOf(t)>-1)throw new Error('Invalid attempt to private "'+t+'" property');var r=n;"object"===("undefined"==typeof n?"undefined":o(n))&&(r=new ve(this.getOptions("getRoot"),E.join(this.getOptions("path"),t),n));var i=Reflect.set(e,t,r);return this.trigger("change",e,t,r),i}.bind(e)}},me=function(e){function t(e,n){var r;s(this,t);var i=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if("undefined"==typeof n||null===n){var a;return a=n,h(i,a)}if(n&&n.isProxy){var o;return y.error("this is Proxy item"),o=n,h(i,o)}if(n&&(n.isRecord||n.isProperty)){var u;return u=n,h(i,u)}if(Array.isArray(n)){var l;return l=i.createCollection(e,n),h(i,l)}return i.setOptions({}),i[ue]=new fe(e),i.setData(i.initProperties(n)),i.interfaceUp(),i.isRecord=!0,i[se]=new Proxy(n,ye(i)),i.on("change",i[le].bind(i)),i.on("change.nested",i[he].bind(i)),r=i[se],h(i,r)}return l(t,e),u(t,[{key:"initProperties",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if("undefined"!=typeof e&&null!==e){var n=Object.keys(e),r=!0,i=!1,a=void 0;try{for(var s,u=n[Symbol.iterator]();!(r=(s=u.next()).done);r=!0){var l=s.value,h=t+(t.length>0?".":"")+l;e.hasOwnProperty(l)&&"object"===o(e[l])&&null!==e[l]&&(this.initProperties(e[l],h),e[l]=new ve(this.getRoot.bind(this),h,e[l]))}}catch(p){i=!0,a=p}finally{try{!r&&u["return"]&&u["return"]()}finally{if(i)throw a}}}return e}},{key:"getRoot",value:function(){return this}},{key:"createCollection",value:function(e,n){for(var r=[],i=0;i<n.length;i++)r.push(new t(e,n[i]));return r}},{key:"interfaceUp",value:function(){if(this[ue].getActionsCount()>0){var e=this[ue].getActions();for(var t in e)this.actionUp(t,e[t])}}},{key:"actionUp",value:function(e){var t=this;this.hasOwnProperty([ge+e])||(this[ge+e]=function(){return t[ue].request(t,e)})}},{key:"setAttr",value:function(e,t){return E.set(e,this[se],{},t)}},{key:"setAttrs",value:function(e){if(e&&"object"===("undefined"==typeof e?"undefined":o(e))&&Object.keys(e).length>0)for(var t in e)this.setAttr(t,e[t])}},{key:"getAttr",value:function(e){return E.get(e,this[se],{})}},{key:"getAttrs",value:function(e){var t=[];if(e&&e.length>0){var n=!0,r=!1,i=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;t.push(this.getAttr(s))}}catch(u){r=!0,i=u}finally{try{!n&&o["return"]&&o["return"]()}finally{if(r)throw i}}}return t}},{key:"getManifest",value:function(){return this[ue]?this[ue].manifest:{}}},{key:le,value:function(){}},{key:he,value:function(){this.trigger("change",this[se],E.join(arguments[1],arguments[2]),arguments[3])}},{key:"setItem",value:function(e){return this.setData(this.initProperties(e)),this[se]=new Proxy(e,ye(this)),this.off("change"),this.off("change.nested"),this.on("change",this[le].bind(this)),this.on("change.nested",this[he].bind(this)),this[se]}},{key:"setFindBy",value:function(){var e;return(e=this[ue]).setFindBy.apply(e,arguments),this}},{key:"setFilter",value:function(){var e;return(e=this[ue]).setFilter.apply(e,arguments),this}},{key:"resetFilter",value:function(){var e;return(e=this[ue]).resetFilter.apply(e,arguments),
this}},{key:"getFilter",value:function(){var e;return(e=this[ue]).getFilter.apply(e,arguments)}},{key:"setSorter",value:function(){var e;return(e=this[ue]).setSorter.apply(e,arguments),this}},{key:"getSorter",value:function(){var e;return(e=this[ue]).getSorter.apply(e,arguments)}},{key:"setPageNumber",value:function(){var e;return(e=this[ue]).setPageNumber.apply(e,arguments),this}},{key:"setPageSize",value:function(){var e;return(e=this[ue]).setPageSize.apply(e,arguments),this}},{key:"setPager",value:function(){var e;return(e=this[ue]).setPager.apply(e,arguments),this}},{key:"resetPager",value:function(){var e;return(e=this[ue]).resetPager.apply(e,arguments),this}},{key:"getPager",value:function(){var e;return(e=this[ue]).getPager.apply(e,arguments)}},{key:"getModelName",value:function(){var e;return(e=this[ue]).getModelName.apply(e,arguments)}}]),t}(C),ke="nc",Oe="nr",be=function(e){function t(e){var n;s(this,t);var r=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{options:e}));return y.log("start app"),y.register("app",r),r.resources={},r.setWorking({interfaces:{},controllers:{},initController:null,currentController:null}),r.preInitRouter(),r.initManager(),r.initAPI(),r.initTemplates(),n=r,h(r,n)}return l(t,e),u(t,[{key:"initManager",value:function(){y.setManager({setAPI:function(e){this.api=e},getAPI:function(){return this.api}})}},{key:"initAPI",value:function(){y.getManager().setAPI(new U(this.getOptions("api")||{}))}},{key:"initTemplates",value:function(){if(this.getOptions("templates")){var e=null;for(var t in this.getOptions("templates"))if(t&&this.getOptions("templates").hasOwnProperty(t)){var n=this.getOptions("templates")[t];e?e.then(te.addLibFromURL.bind(te,n)):e=te.addLibFromURL(n)}e?e.then(this.initManifest.bind(this))["catch"](function(e){y.report("no templates lib",e)}):this.initManifest()}else this.initManifest()}},{key:"initManifest",value:function(){var e=this.getOptions("manifestURL");y.getJSON(e,{}).then(this.setInterfaceManifest.bind(this))["catch"](y.report.bind(this))}},{key:"preInitRouter",value:function(){this.setWorking("router",I),this.getWorking("router").setRoot(this.getOptions("router.root")),I.reRouteExisted()}},{key:"initRouter",value:function(){for(var e={},t=0;t<this.getOptions("router.manifest").length;t++)for(var n=this.getOptions("router.manifest")[t],r=n.paths,i=n.controller,a=0;a<r.length;a++)e[r[a]]=this.bindController(i);this.getWorking("router").addList(e).listen()}},{key:"setInterfaceManifest",value:function(e){this.setOptions("interfaceManifest",e),this.update()}},{key:"getInterfaceManifest",value:function(){return this.getOptions("interfaceManifest")}},{key:"update",value:function(){this.updateInterfaces(),this.initController(),this.allResourcesReady()&&this.startApp()}},{key:"startApp",value:function(){this.initRouter()}},{key:"bindController",value:function(e){var t=this;return function(){new e(t,arguments)}}},{key:"initController",value:function n(){if("undefined"!=typeof this.getOptions("initController")){var n=this.getOptions("initController");this.setWorking("initController",new n(this))}}},{key:"getCurrentController",value:function(){return this.getWorking("currentController")}},{key:"setCurrentController",value:function(e){return this.setWorking("currentController",e),this}},{key:"updateInterfaces",value:function(){var e=this;this.clearInterfaces();var t=this.getOptions("interfaceManifest");if(t){var n=function(n){var r=t[n];e.getWorking("interfaces")[n]=function(e){return new me(r,e)},window["nr"+y.capitalizeFirstLetter(n)]=e.getWorking("interfaces")[n]};for(var r in t)n(r)}}},{key:"getRecordName",value:function(e){return Oe+y.capitalizeFirstLetter(e)}},{key:"getControllerName",value:function(e){return ke+y.capitalizeFirstLetter(e)}},{key:"getInterfaces",value:function(){return this.getWorking("interfaces")}},{key:"clearInterfaces",value:function(){return this.setWorking("interfaces",{}),this}},{key:"waitThisResource",value:function(e,t){return this.resources.hasOwnProperty(e)||(this.resources[e]={}),this.resources[e][t]=!1,this.onResourceReady.bind(this,e,t)}},{key:"onResourceReady",value:function(e,t){this.resources[e][t]=!0,this.allResourcesReady()&&this.startApp()}},{key:"allResourcesReady",value:function(){var e,t;for(e in this.resources)for(t in this.resources[e])if(!this.resources[e][t])return!1;return!0}}]),t}(C),Pe=Symbol("processors"),we=function(e){function t(){var e;s(this,t);var n=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n[Pe]={},e=n,h(n,e)}return l(t,e),u(t,[{key:"setProcessor",value:function(){return this.setCommon(this[Pe],arguments),this}},{key:"getProcessor",value:function(){return this.getCommon(this[Pe],arguments)}},{key:"clearProcessors",value:function(){return this.setCommon(this[Pe],{}),this}},{key:"add",value:function(){if(2===arguments.length)this.setProcessor(arguments[0],arguments[1]);else if(1===arguments.length&&"object"===o(arguments[0]))for(var e in arguments[0])this.setProcessor(e,arguments[0][e])}},{key:"get",value:function(){return this.getProcessor.apply(this,arguments)}},{key:"clear",value:function(){return this[Pe]={},this}}]),t}(C),Se=new we,Re=Symbol("components"),Ee=function(e){function t(e){var n;s(this,t);var r=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r[Re]={},r.init(e),r.render(),n=r,h(r,n)}return l(t,e),u(t,[{key:"init",value:function(e){this.input=e,this.component=e.component,this.initData(e.data?e.data:{}),this.initOptions(e.options?e.options:{}),this.initWorking(e.template),this.initTemplate()}},{key:"initTemplate",value:function(){this.setWorking("template",this.getWorking("getTemplate")())}},{key:"initData",value:function(e){this.setData(e),this.getData().isRecord&&this.getData().on("change",this.onChange.bind(this))}},{key:"initOptions",value:function(e){this.setOptions(e)}},{key:"initWorking",value:function(e){this.setWorking({getTemplate:e,partId:this.getOptions("partId")?this.getOptions("partId"):Y.PART_ID_PREFIX+Math.random()})}},{key:"getBreadCrumps",value:function(){return this.component?[].concat(p(this.component.getBreadCrumps()),[this.getWorking("partId")]):[this.getWorking("partId")]}},{key:"render",value:function(){this.clearStash(),this.setWorkingMapping(),this.execProcessors(this.getData()),this.searchForSubTemplates(),this.stashRendered()}},{key:"onChange",value:function(e,t,n){this.update(t),this.trigger("obsolete",e,t,n)}},{key:"update",value:function(e){this.execProcessors(this.getData());for(var t in this[Re]){var n=this[Re][t],r=!0;if(e){if(null===n.getOptions("dataPath"))continue;var i=E.normilizePath(n.getOptions("dataPath")),a=E.normilizePath(e);r=E.ifFullSubPath(a,i)}r&&n.update()}}},{key:"setWorkingMapping",value:function(){this.setWorking("mapping",this.createMapping())}},{key:"createMapping",value:function(){var e=this.findAllProcessors();return e}},{key:"findAllProcessors",value:function(){for(var e=[],t=y.getAttributesStartsWith(this.getWorkingTemplateElement(),Y.PROCESSOR_EXPRESSION_PREFIX),n=0;n<t.length;n++)for(var r=0,i=t[n].attributes,a=i.length;a>r;r++)if(0===i[r].nodeName.indexOf(Y.PROCESSOR_EXPRESSION_PREFIX)){var o=this.parseProcessorExpression(i[r].nodeName);o.element=t[n],o.processorExpression=i[r].nodeName,o.attributeExpression=i[r].value,e.push(o)}return e}},{key:"parseProcessorExpression",value:function(e){var t={params:[],processorName:"",ifCondition:!1};return e=e.replace(Y.PROCESSOR_EXPRESSION_PREFIX,""),e.indexOf(Y.PROCESSOR_EXPRESSION_CONDITION_POSTFIX)===e.length-Y.PROCESSOR_EXPRESSION_CONDITION_POSTFIX.length&&(t.ifCondition=!0,e=e.replace(Y.PROCESSOR_EXPRESSION_SEPARATOR+Y.PROCESSOR_EXPRESSION_CONDITION_POSTFIX,"")),t.params=e.split(Y.PROCESSOR_EXPRESSION_SEPARATOR),t.processorName=t.params[0],t.params=t.params.slice(1),t}},{key:"execProcessors",value:function(e,t){var n=this.getWorking("mapping");if(n)for(var r=0;r<n.length;r++){var i=n[r];i.attributeResult=this.getAttributeExpressionResult(i.attributeExpression,e,t);var a=i.processorName,o=Se.get(a);o?(o(i,e,this.getOptions("helpers",{})),i.element.removeAttribute(i.processorExpression)):y.error("no processor like",a)}this.trigger("rendered")}},{key:"getAttributeExpressionResult",value:function(e,t){return E.get(e,t,this.getOptions("helpers",{}))}},{key:"clearSubTemplates",value:function(){this.destroySubs(),this.setWorking("subs",[])}},{key:"destroySubs",value:function(){if(this.getWorking("subs")){var e=!0,t=!1,n=void 0;try{for(var r,i=this.getWorking("subs")[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var a=r.value;a.destroy()}}catch(o){t=!0,n=o}finally{try{!e&&i["return"]&&i["return"]()}finally{if(t)throw n}}}}},{key:"destroy",value:function(){this.clearSubTemplates();for(var e=0;e<this.getStash().length;e++){var t=this.getStash()[e];t.parentNode&&t.parentNode.removeChild(t)}}},{key:"ifSubElementRendered",value:function(e){return e.attributes.ntRendered&&"true"===e.attributes.ntRendered.value}},{key:"searchForSubTemplates",value:function(){this.clearSubTemplates();for(var e=this.getWorkingTemplateElement().querySelectorAll(Y.TEMPLATE_TAG),t=0;t<e.length;t++)this.ifSubElementRendered(e[t])||this.renderSub(e[t])}},{key:"addSub",value:function(e){e.setAttribute("nt-rendered",!0),this.getWorking("subs").push({targetEl:e,path:e.attributes.data?e.attributes.data.value:"",name:e.attributes.name?e.attributes.name.value:"",src:e.attributes.src?e.attributes.name.src:"",id:e.attributes.id?e.attributes.id.value:Y.COMPONENT_ID_PREFIX+Math.random(),renderedList:[]})}},{key:"renderSub",value:function(e){if(e){var t={dataPath:e.attributes.data?e.attributes.data.value:null,name:e.attributes.name?e.attributes.name.value:"",src:e.attributes.src?e.attributes.src.value:"",id:e.attributes.id?e.attributes.id.value:Y.COMPONENT_ID_PREFIX+Math.random()},n={data:null!==t.dataPath?this.getAttributeExpressionResult(t.dataPath,this.getData()):null,template:{name:t.name,src:t.src},options:{helpers:this.getOptions("helpers",{}),targetEl:e,name:t.name,renderAnd:"placeAfter",id:t.id,ntEl:e,dataPath:t.dataPath},owner:this};e.setAttribute("id",t.id),e.setAttribute("nt-rendered",!0),this[Re][t.id]=new _e(n)}}},{key:"clearStash",value:function(){this.setWorking("stash",[])}},{key:"getWorkingTemplateElement",value:function(){return this.getWorking("template")}},{key:"getStash",value:function(){return this.getWorking("stash")}},{key:"stashRendered",value:function(){for(var e=this.getWorkingTemplateElement(),t=0;t<e.childNodes.length;t++)this.addToStash(e.childNodes[t])}},{key:"replaceRendered",value:function(){for(var e=this.getWorkingTemplateElement(),t=this.getStash(),n=[],r=t.length>0?t[0]:this.getOptions("ntEl"),i=r.parentNode,a=0;a<e.childNodes.length;a++)n.push(e.childNodes[a]);for(var o=0;o<n.length;o++)r.nextSibling?r.parentNode.insertBefore(n[o],r.nextSibling):r.parentNode.appendChild(n[o]);for(var s=0;s<t.length;s++)i.removeChild(t[s]);this.setWorking("stash",n)}},{key:"addToStash",value:function(e){this.getStash().push(e)}},{key:"isData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.getData()===e}},{key:"hide",value:function(){}},{key:"show",value:function(){}}]),t}(C),De={before:function(e){for(var t=0;e.children.length-t;)"NT"===e.children[0].nodeName?t++:e.removeChild(e.children[t]);e.textContent=""},beforeEach:function(){},main:function(e,t){for(var n=0;n<t.length;n++)e.appendChild(t[n])},afterEach:function(){},after:function(){}},We={before:function(){},main:function(e,t){for(var n=0;n<t.length;n++)e.parentNode.insertBefore(t[n],e.nextSibling)},after:function(){}},Ae={before:function(){},main:function(e,t){for(var n=0;n<t.length;n++)e.parentNode.insertBefore(t[n],e)},after:function(){}},xe={before:function(){},main:function(e,t){for(var n=t.length-1;n>-1;n--)e.children.length?e.insertBefore(t[n],e.children[0]):e.appendChild(t[n])},after:function(){}},Ne={before:function(){},main:function(e,t){for(var n=0;n<t.length;n++)e.appendChild(t[n])},after:function(){}},Ce={before:function(){},beforeEach:function(){},main:function(e,t){for(var n=0;n<t.length;n++)e.parentNode.insertBefore(t[n],e.nextSibling)},afterEach:function(){},after:function(e){"NT"!==e.nodeName&&e.parentNode.removeChild(e)}},Te={place:De,placeAfter:We,placeBefore:Ae,placeFirst:xe,placeLast:Ne,replace:Ce},Le=Symbol("parts"),_e=function(e){function t(e){var n;s(this,t);var r=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.resetParts(),r.on("ready",r.render.bind(r)),r.init(e),n=r,h(r,n)}return l(t,e),u(t,[{key:"getBreadCrumps",value:function(){return this.owner?[].concat(p(this.owner.getBreadCrumps()),[this.getOptions("id")]):[this.getOptions("id")]}},{key:"init",value:function(e){this.input=e,this.owner=e.owner?e.owner:null,this.initOptions(e.options?e.options:{}),this.initWorking(e),this.prepareTemplateElement(e.template?e.template:null)}},{key:"initData",value:function(e){this.setData(e)}},{key:"initEvents",value:function(e){var t=!0,n=!1,r=void 0;try{for(var i,a=e[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;this.on.apply(this,p(o))}}catch(s){n=!0,r=s}finally{try{!t&&a["return"]&&a["return"]()}finally{if(n)throw r}}}},{key:"initOptions",value:function(e){this.setOptions(e),this.getOptions("id")||this.setOptions("id",Y.COMPONENT_ID_PREFIX+Math.random()),this.getOptions("ntEl")||this.initMarkElement()}},{key:"initMarkElement",value:function(){var e=document.createElement("nt");e.setAttribute("id",this.getOptions("id")),e.setAttribute("nt-rendered",!0),this.setOptions("ntEl",e);var t=this.getPlacer(this.getOptions("renderAnd")),n=this.getOptions("targetQuery");if(n){var r=document.querySelector(n);r&&this.setOptions("targetEl",r)}if(!this.getOptions("targetEl"))throw"No target to place rendered";t.main(this.getOptions("targetEl"),[e])}},{key:"initWorking",value:function(e){this.unsetReady(e)}},{key:"prepareTemplateElement",value:function(e){e?e.hasOwnProperty("html")&&e.html?this.setProtoTemplateElement(te.wrap("","",e.html)):e.hasOwnProperty("el")&&e.el?this.setProtoTemplateElement(e.el.cloneNode(!0)):e.hasOwnProperty("src")&&e.src?te.addFromURL(e.src,e.src).then(this.setProtoTemplateElement.bind(this))["catch"](y.report):e.hasOwnProperty("name")&&e.name&&this.setProtoTemplateElement(te.get(e.name)):this.unsetReady()}},{key:"setProtoTemplateElement",value:function(e){e?(this.setWorking("protoTemplateElement",e),this.trigger("ready")):y.error("Wrong template container element")}},{key:"getProtoTemplateElement",value:function(){return this.getWorking("protoTemplateElement")}},{key:"getProtoTemplateElementClone",value:function(){return this.getWorking("protoTemplateElement").cloneNode(!0)}},{key:"getWorkingTemplateElement",value:function(){return this.getWorking("templateElement")}},{key:"resetWorkingTemplateElement",value:function(){return this.setWorking("templateElement",this.getProtoTemplateElement().cloneNode(!0))}},{key:"setReady",value:function(){this.setWorking("ready",!0)}},{key:"unsetReady",value:function(){this.setWorking("ready",!1)}},{key:"isReady",value:function(){return this.setWorking("ready")}},{key:"clearParts",value:function(){if(this[Le]&&Array.isArray(this[Le])&&this[Le].length){var e=!0,t=!1,n=void 0;try{for(var r,i=this[Le][Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var a=r.value;a.destroy&&a.destroy()}}catch(o){t=!0,n=o}finally{try{!e&&i["return"]&&i["return"]()}finally{if(t)throw n}}}this.resetParts()}},{key:"destroy",value:function(){this.clearParts(),this.getOptions("ntEl")&&this.getOptions("ntEl").parentNode&&this.getOptions("ntEl").parentNode.removeChild(this.getOptions("ntEl")),this.dead=!0,this.offAll()}},{key:"resetParts",value:function(){this[Le]=[]}},{key:"getParts",value:function(){return this[Le]}},{key:"addPart",value:function(e){this[Le].push(e)}},{key:"render",value:function(){this.clearParts(),this.getProtoTemplateElement()&&(this.forEachData(this.renderPart.bind(this)),this.placeRendered()),this.trigger("afterRender")}},{key:"update",value:function(){this.removeObsoleteParts(),this.getProtoTemplateElement()&&(this.forEachData(this.renderPart.bind(this)),this.placeRendered()),this.trigger("afterUpdate")}},{key:"placeRendered",value:function(){if(this.getOptions("targetEl")){var e=this.getPlacer(this.getOptions("renderAnd"));e.before(this.getOptions("targetEl")),this.forEachData(this.placePart.bind(this)),e.after(this.getOptions("targetEl"))}else y.error("no target element")}},{key:"placePart",value:function(e,t){var n=this.getPartByData(e),r=n&&n.getStash?n.getStash():[],i=void 0,a=void 0,o=void 0;0===t?(o=this.getPlacer(this.getOptions("renderAnd")),i=this.getOptions("targetEl")):(o=this.getPlacer(Y.DEFAULT_PLACER_LOOP),i=this.getWorking("lastPlacedNode")),o.main(i,r),a=i;var s=!0,u=!1,l=void 0;try{for(var h,p=r[Symbol.iterator]();!(s=(h=p.next()).done);s=!0){var c=h.value;1===c.nodeType&&(a=c,a.setAttribute("nt-component",this.getOptions("id")),a.setAttribute("nt-part",n.getWorking("partId")))}}catch(g){u=!0,l=g}finally{try{!s&&p["return"]&&p["return"]()}finally{if(u)throw l}}this.setWorking("lastPlacedNode",a)}},{key:"getPlacer",value:function(e){return Te.hasOwnProperty(e)?Te[e]:Te[Y.DEFAULT_PLACER]}},{key:"forEachData",value:function(e){if(Array.isArray(this.getData()))for(var t=0;t<this.getData().length;t++)e(this.getData()[t],t);else e(this.getData(),0)}},{key:"forEachPart",value:function(e){if(Array.isArray(this.getParts()))for(var t=0;t<this.getParts().length;t++)e(this.getParts()[t],t)}},{key:"renderPart",value:function(e){if(this.getPartByData(e))this.updatePart(this.getPartByData(e));else{var t=new Ee({data:e,template:this.getProtoTemplateElementClone.bind(this),options:this.getOptions(),component:this});this.addPart(t)}}},{key:"updatePart",value:function(e){e.update()}},{key:"removeObsoleteParts",value:function(){y.pipe(void 0,[this.findActualParts.bind(this),this.removeNotActualParts.bind(this)])}},{key:"findActualParts",value:function(){var e=this,t=[];return this.forEachData(function(n){var r=e.getPartByData(n);r&&t.push(r)}),t}},{key:"removeNotActualParts",value:function(e){for(var t=0;t<this.getParts().length;t++)-1===e.indexOf(this.getParts()[t])&&(this.getParts()[t].destroy(),this.getParts().splice(t,1),t--)}},{key:"getPartByData",value:function(e){for(var t in this.getParts())if(this.getParts()[t].isData(e))return this.getParts()[t];return!1}},{key:"show",value:function(){}},{key:"hide",value:function(){}}]),t}(C),Fe=".page-content",Ie=".html",Me="default",je=!0,qe="Models",Ue="Model",Be="main",ze="place",He=function(e){function t(e){var n;s(this,t);var r=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));y.log("start controller"),r.app=e,r.setWorking({ready:!1,views:{},libs:{},viewName:Me,helpers:{}}),r.setData({}),r.setOptions({moduleName:Be,containerSelector:Fe,prefix:r.app.getOptions("paths.module"),postfix:Ie,renderFromURL:je,names:{plural:qe,single:Ue}}),r.on("ready",r.initRender.bind(r));var i=r.app.getInterfaces();r.make={};for(var a in i)i.hasOwnProperty(a)&&(r.make[a]=i[a]);return n=r,h(r,n)}return l(t,e),u(t,[{key:"initRender",value:function(){this.render(this.getWorking("viewName"),this.getData(),this.getWorking("helpers"))}},{key:"render",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default",t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new Promise(function(i,a){var o=t.getView(e);if("undefined"==typeof o||null===o)a("No view found",e);else{if(o=y.extend({},o),("undefined"==typeof o.targetEl||null===o.targetEl)&&"undefined"!=typeof o.targetQuery&&null!==o.targetQuery&&o.targetQuery.length>0?o.targetEl=document.querySelector(o.targetQuery):o.targetEl=document.querySelector(t.getOptions("containerSelector")),o.data=n,"undefined"!=typeof o.helpers&&null!==o.helpers&&Object.keys(o.helpers).length>0?o.helpers=y.extend(o.helpers,r):o.helpers=r,t.getOptions("renderFromURL")){if("undefined"==typeof o.templateURL||null==o.templateURL||0==o.templateURL.length){var s=o.common?t.app.getOptions("paths.common"):t.getModulePrefix(),u="undefined"!=typeof o.name&&null!==o.name&&o.name.length>0?o.name:e,l=t.getOptions("postfix");o.templateURL=[s,u].join("/")+l}}else o.hasOwnProperty("templateName")&&(o.templateName=t.getOptions("prefix")+o.templateName+t.getOptions("postfix"));t.setWorking("component",new _e({data:n,template:{name:o.templateName,src:o.templateURL},events:[["afterRender",i]],options:{targetEl:o.targetEl,helpers:r,renderAnd:o.renderAnd||ze}}))}})}},{key:"getApp",value:function(){return this.app}},{key:"setModel",value:function(e){return this.setWorking("model",e),this}},{key:"getModel",value:function(){return this.setWorking("model")}},{key:"setReady",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!0;this.setWorking("ready",e),e?this.trigger("ready"):this.trigger("busy")}},{key:"setView",value:function(e,t){return this.setWorking(E.join("views",e),t),this}},{key:"setViews",value:function(e){for(var t in e)this.setWorking(E.join("views",t),e[t]);return this}},{key:"getView",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";return this.getWorking(E.join("views",e))}},{key:"setModuleName",value:function(e){return this.setOptions("moduleName",e),this}},{key:"getModuleName",value:function(){return this.getOptions("moduleName")}},{key:"getModulePrefix",value:function(){return[this.app.getOptions("paths.modules"),this.getModuleName()].join("/")}},{key:"preloadLib",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Promise(function(n,r){if("object"!==("undefined"==typeof t?"undefined":o(t)))n();else{e.setWorking("loading",[]);var i=function(i){e.getWorking("loading").push(t[i]),e.make[t[i]]({}).$listAll().then(function(r){e.getOptions("libs")||e.setOptions("libs",{}),e.getOptions("libs")[i]=r,e.getWorking("loading").indexOf(t[i])>-1&&e.getWorking("loading").splice(e.getWorking("loading").indexOf(t[i]),1),0===e.getWorking("loading").length&&n()})["catch"](function(e){y.report(e),r()})};for(var a in t)i(a);0===e.getWorking("loading").length&&n()}})}},{key:"queeUpload",value:function(e,t){this.getWorking("uploadQuee")||this.setWorking("uploadQuee",{}),this.getWorking("uploadQuee")[e]=t}},{key:"execUploads",value:function(e){var t=this,n=this.getWorking("uploadQuee");return new Promise(function(r,i){if("object"!==("undefined"==typeof n?"undefined":o(n)))r(e);else{t.setWorking("uploading",{});var a=function(a){var o=n[a];o.length>1?e[a]=[]:e[a]="";for(var s=function(n){t.getWorking("uploading").hasOwnProperty(a)||(t.getWorking("uploading")[a]=0),t.getWorking("uploading")[a]++,t.app.getWorking("uploader").upload(o[n]).then(function(i){y.log("file uploaded",a,n,i),t.getWorking("uploading")[a]--,0===t.getWorking("uploading")[a]&&delete t.getWorking("uploading")[a],Array.isArray(e[n])?e[a].push(i.hash):e[a]=i.hash,0===Object.keys(t.getWorking("uploading")).length&&r(e)})["catch"](function(e){y.report(e),i(e)})},u=0;u<o.length;u++)s(u)};for(var s in n)a(s);0===Object.keys(t.getWorking("uploading")).length&&r(e)}})}},{key:"onAfterRender",value:function(){this.trigger("afterRender")}}]),t}(C),Qe="form_",Xe="default",Ve="Form default title",$e={},Je=["options","manifest","app"],Ge=function(e){function t(e){var n;s(this,t);var r=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.getOptions("prefix")||r.setOptions("prefix",Qe),r.setWorking("components",[]),r.getData().isRecord||r.setData(new me({},r.getData())),r.on("submit",r.onSubmit.bind(r)),r.on("reset",r.onReset.bind(r)),r.on("cancel",r.onCancel.bind(r)),r.render(),n=r,h(r,n)}return l(t,e),u(t,[{key:"getManifest",value:function(){return this.getData().getManifest()}},{key:"getActionData",value:function(){var e=this.getManifest();return e&&e.actions&&e.actions.hasOwnProperty(this.getOptions("action"))?e.actions[this.getOptions("action")]:null}},{key:"getFormFieldsList",value:function(){var e=this.getActionData(),t=[],n=this.getOptions("role",Xe);return e&&e.fields&&e.fields.hasOwnProperty(n)&&(t=e.fields[n]),t}},{key:"render",value:function(){this.renderWrapper()}},{key:"getPartTemplateName",value:function(e){return this.getOptions("prefix")+e}},{key:"renderWrapper",value:function(){if(this.getWorking("wrapper"))this.getWorking("wrapper").update();else{var e={data:this.getWrapperData(),template:{name:this.getPartTemplateName("wrapper")},options:{helpers:this.getOptions("helpers"),targetEl:this.getOptions("targetEl"),targetQuery:this.getOptions("targetQuery"),id:this.getOptions("id")},events:[["afterRender",this.bindFormEvents.bind(this)],[["afterRender","afterUpdate"],this.renderComponents.bind(this)]]},t=new _e(e);this.setWorking("wrapper",t)}}},{key:"getWrapperData",value:function(){var e=this.getActionData();return{title:e.title?e.title:Ve}}},{key:"renderComponents",value:function(){if(this.getWorking("components")&&this.getWorking("components").length)for(var e=0;e<this.getWorking("components").length;e++)this.getWorking("components")[e].component.update();else for(var t=0;t<this.getFormFieldsList().length;t++){var n=this.getFormFieldsList()[t];this.addFieldComponent(n)}}},{key:"clearFieldsComponents",value:function(){for(var e=this.getWorking("components");e.length>0;)e[0].component.destroy(),e.splice(0,1)}},{key:"getFieldsLibs",value:function(){var e={options:{},manifest:{},app:{}};return this.getOptions("fields")&&(e.options=this.getOptions("fields")),y.getApp()&&y.getApp().getOptions("fields")&&(e.app=y.getApp().getOptions("fields")),this.getData().isRecord&&this.getData().getManifest()&&(e.manifest=this.getData().getManifest().fields),e}},{key:"getFieldsDefinition",value:function(e){var t=$e,n=this.getFieldsLibs(),r=!0,i=!1,a=void 0;try{for(var o,s=Je[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var u=o.value;if(n.hasOwnProperty(u)&&n[u].hasOwnProperty(e))return n[u][e]}}catch(l){i=!0,a=l}finally{try{!r&&s["return"]&&s["return"]()}finally{if(i)throw a}}return t}},{key:"addFieldComponent",value:function(e){var t=this,n=this.getFieldsDefinition(e),r={field:{name:e,title:n.label||n.placeholder,type:n.type,label:n.label,array:n.array,"default":n["default"],placeholder:n.placeholder,options:this.getOptions(E.join("helpers","libs",e))}},i=y.extend({isChecked:function(n){return n.item.value===t.getData(e)},field:r.field,data:this.getData()},this.getOptions("helpers"));r.component=new _e({data:this.getData(),template:{name:this.getPartTemplateName(n.type)},options:{helpers:i,targetEl:this.getFormTargetElement(n.target),renderAnd:"placeLast",events:[["afterDataChange",this.collectDataFromComponents.bind(this)]]}}),this.getWorking("components").push(r)}},{key:"collectDataFromComponents",value:function(e){y.log("collect data from components",e)}},{key:"getFormTargetElement",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"body";e||(e="body");var t=this.getOptions("targetEl").querySelector('[role="'+e+'"]');return t||"body"===e||(e="body",t=this.getOptions("targetEl").querySelector('[role="'+e+'"]')),t||"body"!=e?t:this.getOptions("targetEl")}},{key:"collectData",value:function(){}},{key:"bindFormEvents",value:function(){var e=this.getOptions("targetQuery");if(e){var t=document.querySelector(e);t&&this.setOptions("targetEl",t)}if(this.getOptions("targetEl")){var n=this.getOptions("targetEl").querySelector("form");n&&(n.addEventListener("submit",this.onSubmit.bind(this)),n.addEventListener("reset",this.onReset.bind(this)))}}},{key:"updateField",value:function(e){for(var t=0;t<this.getWorking("components").length;t++)this.getWorking("components")[t].field.name===e&&this.getWorking("components")[t].component.update()}},{key:"update",value:function(){for(var e=0;e<this.getWorking("components").length;e++)this.getWorking("components")[e].component.update()}},{key:"onSubmit",value:function(){}},{key:"onCancel",value:function(){}},{key:"onReset",value:function(){}},{key:"getFields",value:function(){}},{key:"addField",value:function(){}},{key:"removeField",value:function(){}}]),t}(C),Ke="edit",Ye="create",Ze={_id:null,title:"Title",value:"Value"},et=function(e){function t(e,n){var r;s(this,t);var i=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.app));return i.parent=e,i.setOptions("params",n),y.log("CRUD Create"),i.setViews({"default":{name:i.parent.getOptions("views.create.name")||Ke,common:i.parent.getOptions("views.create.common")||!0,targetQuery:i.parent.getOptions("views.create.containerSelector")||i.parent.getOptions("containerSelector"),helpers:{}}}),i.preloadLib(i.parent.getOptions("views.create.preload")).then(i.initData.bind(i)).then(i.renderWrapper.bind(i)).then(i.renderForm.bind(i)).then(function(){i.trigger("afterRender")})["catch"](y.report),r=i,h(i,r)}return l(t,e),u(t,[{key:"createDefault",value:function(){return this.parent.getOptions("views.create.defaultItem")&&this.parent.getModuleName()&&this.parent.make[this.parent.getModuleName()]?this.parent.make[this.parent.getModuleName()](y.extend({},this.parent.getOptions("views.create.defaultItem"))):this.parent.initItem?this.parent.initItem():this.parent.getModuleName()&&this.parent.make[this.parent.getModuleName()]?this.parent.make[this.parent.getModuleName()](y.extend({},Ze)):new me({},y.extend({},Ze))}},{key:"initData",value:function(){var e=this;return new Promise(function(t,n){try{e.setData(e.createDefault()),t(e.getData())}catch(r){n(r)}})}},{key:"renderWrapper",value:function(){return this.render("default",{},{})}},{key:"renderForm",value:function(){var e=this;return new Promise(function(t,n){try{e.form=new Ge({data:e.getData(),options:{action:e.parent.getOptions("views.create.action")||Ye,targetQuery:e.parent.getOptions("views.create.targetQuery")||e.parent.getOptions("targetQuery"),targetEl:document.querySelector(e.parent.getOptions("views.create.targetQuery")||e.parent.getOptions("targetQuery")),prefix:e.parent.getOptions("views.create.prefix")||e.parent.getOptions("prefix"),role:e.parent.getOptions("views.create.role")||e.parent.getOptions("role"),helpers:y.extend({linkBackToList:e.parent.linkBackToList(),file:function(t){var n=t.e.target.files||t.e.dataTransfer.files;y.log("file changed",n),t.helpers.field.name&&n&&e.queeUpload(t.helpers.field.name,n)},submit:function(){y.log("submit form ",e.newItem),e.execUploads(e.getData()).then(e.create.bind(e))},afterSubmit:function(){e.goToTable()},libs:e.getOptions("libs")},e.parent.getOptions("views.create.helpers")||{})},events:[["afterRender",t],[["afterSubmit","afterRestore"],e.parent.backToList.bind(e.parent)]]})}catch(r){n(r)}})}},{key:"create",value:function(e){var t=this;e["$"+this.parent.getOptions("views.create.action")]().then(function(e){y.log("form saved",e),t.parent.app.getWorking("router").navigate(t.parent.getModuleName())})["catch"](function(e){y.error("form not saved",e)})}}]),t}(He),tt=20,nt=0,rt=6,it=1,at=" count",ot="_id",st="preprocessor",ut=function(e){function t(e){var n;s(this,t);var r=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.setWorking("filteredData",[]),r.getData()&&Array.isArray(r.getData("rows"))||r.setData(new me({},{rows:[],pagination:{items:{count:0,from:0,to:0},pages:{count:0,from:0,to:0,current:0,list:[]}}})),r.resetPager(),r.resetFilter(),r.resetSorter(),r.render(),n=r,h(r,n)}return l(t,e),u(t,[{key:"render",value:function(){if(this.getWorking("component"))this.getWorking("component").update();else{var e=new _e({data:this.getData(),template:{name:"table_wrapper"},options:{renderAnd:this.getOptions("renderAnd"),targetEl:this.getOptions("targetEl"),helpers:this.getOptions("helpers")},events:[[["afterRender","afterUpdate"],[this.initAutoloader.bind(this),this.renderInside.bind(this)]]]});this.setWorking("component",e)}}},{key:"renderInside",value:function(){this.renderHeader(),this.updateData(),this.renderBody(),this.renderFooter(),this.bindSearch(),this.bindCustomBindings()}},{key:"renderHeader",value:function(){var e=this.getOptions("targetEl").querySelector("thead tr");
if(e)for(var t=this.getOptions("fields"),n=0;n<t.length;n++){var r=document.createElement("TH");r.innerHTML=t[n].title,t[n].hasOwnProperty("sortable")&&t[n].sortable&&this.attachSortingHandlers(r,t[n].path),e.appendChild(r)}}},{key:"attachSortingHandlers",value:function(e,t){var n=this;e.addEventListener("click",function(r){return r.preventDefault(),n.changeSortingOptions(e,t),!1}),e.style.cursor="pointer"}},{key:"changeSortingOptions",value:function(e,t){if(t===this.getSorter().sortByField?this.setSorter({sortByField:t,sortDirection:-1*this.getSorter().sortDirection}):this.setSorter({sortByField:t,sortDirection:it}),e.parentNode)for(var n=0;n<e.parentNode.children.length;n++)e.parentNode.children[n]!==e&&(e.parentNode.children[n].classList.remove("sorting_asc"),e.parentNode.children[n].classList.remove("sorting_desc"),e.parentNode.children[n].setAttribute("aria-sort","none"));this.getSorter().sortDirection>0?(e.classList.remove("sorting_desc"),e.classList.add("sorting_asc"),e.setAttribute("aria-sort","ascending")):(e.classList.remove("sorting_asc"),e.classList.add("sorting_desc"),e.setAttribute("aria-sort","descending"))}},{key:"setSorter",value:function(e){this.setWorking("sorter",e),this.invalidateData(),this.updateData()}},{key:"resetSorter",value:function(){this.setSorter({sortByField:ot,sortDirection:it})}},{key:"getSorter",value:function(){return this.getWorking("sorter")}},{key:"getFilterSearch",value:function(){return"undefined"!=typeof this.getFilter()&&null!==this.getFilter()&&"undefined"!=typeof this.getFilter().filterSearch&&null!==this.getFilter().filterSearch?this.getFilter().filterSearch.toString():""}},{key:"invalidateData",value:function(){this.getOptions("liveLoad")&&(this.getOptions("onePager")?(this.getData("rows").length>0&&this.getData("rows").splice(0,this.getData("rows").length),this.resetPager()):this.getRowsCount())}},{key:"setFilter",value:function(e){this.setWorking("filter",e),this.invalidateData(),this.updateData()}},{key:"resetFilter",value:function(){this.setFilter({}),this.updateData()}},{key:"getFilter",value:function(){return this.getWorking("filter")}},{key:"setPager",value:function(e){this.setWorking("pager",e),this.updateData()}},{key:"resetPager",value:function(){this.setWorking("pager",{pageSize:isNaN(this.getOptions("pageSize"))?tt:this.getOptions("pageSize"),pageNumber:isNaN(this.getOptions("pageNumber"))?nt:this.getOptions("pageNumber")})}},{key:"getPager",value:function(){return this.getWorking("pager")}},{key:"setUpdating",value:function(){this.setWorking("updating",!0)}},{key:"setUpdated",value:function(){this.setWorking("updating",!1)}},{key:"ifUpdating",value:function(){return this.getWorking("updating")}},{key:"loadData",value:function(){var e=this.getOptions("interface")({}).setFilter(this.getFilter()).setSorter(this.getSorter()).setPager(this.getPager().pageSize,this.getPager().pageNumber);return e.$list()}},{key:"updateData",value:function(){var e=this;if(this.getOptions("liveLoad")&&this.getOptions("interface")){if(this.ifUpdating())return;this.setUpdating(),this.loadData().then(function(t){e.setData("rows",e.getData("rows").concat(t)),e.processData()}).then(this.getRowsCount.bind(this)).then(function(){e.refreshBody(),e.setUpdated()})["catch"](function(t){y.error(t),e.setUpdated()})}else this.setUpdating(),this.processData(),this.refreshBody(),this.setUpdated()}},{key:"processData",value:function(){var e=this.getFilter();"undefined"!=typeof e&&null!==e&&"undefined"!=typeof e.filterSearch&&null!==e.filterSearch&&e.filterSearch.length>0?this.setWorking("filteredData",this.getData("rows").filter(this.testDataItem.bind(this))):this.setWorking("filteredData",this.getData("rows"));var t=this.getSorter();"undefined"!=typeof t&&null!==t&&this.getWorking("filteredData").sort(function(e,n){var r=E.get(t.sortByField,e,{}),i=E.get(t.sortByField,n,{});return isNaN(r)?"undefined"!=typeof r&&"undefined"!=typeof i&&r.localeCompare?r.localeCompare()*-t.sortDirection:0:(i>r?1:-1)*t.sortDirection})}},{key:"bindSearch",value:function(){var e=this,t=this.getOptions("targetEl").querySelectorAll('input[name="search"]')[0];if(t){var n=function(t){return e.setFilter({filterSearch:t.currentTarget.value}),!0};t.addEventListener("keyup",n),t.addEventListener("enter",n)}}},{key:"bindCustomBindings",value:function(){if(this.getOptions("bindings")&&this.getOptions("bindings"))for(var e in this.getOptions("bindings"))for(var t=this.getOption("targetEl").querySelectorAll(e),n=0;n<t.length;n++){var r=t[n];for(var i in this.getOptions("bindings")[e])r.addEventListener(i,this.getOptions("bindings")[e][i])}}},{key:"loadNext",value:function(){this.getWorking("pager").pageNumber++,this.updateData()}},{key:"renderRow",value:function(e,t){for(var n=this,r=document.createElement("TR"),i=this.getOptions("fields"),a=function(){var a=document.createElement("TD"),u=i[o],l=null,h=E.get(u.path,e,n.getOptions("helpers"));if(u.hasOwnProperty("editable")&&!u.hasOwnProperty("component")&&(a.setAttribute("contentEditable",!0),a.dataset.path=u.path,a.dataset.itemId=e[n.getOptions("itemIdField")],a.dataset.value=h,a.addEventListener("blur",function(){E.set(u.path,e,n.getOptions("helpers"),a.textContent),n.updateData()})),u.hasOwnProperty(st)&&(l=u[st](h,e,t)),u.hasOwnProperty("component")?new _e({data:u.component.data||l||{val:h,item:e,index:t},template:u.component.template,options:{targetEl:a,helpers:n.getOptions("helpers")},events:u.component.events||[]}):a.innerHTML=l||h,u.hasOwnProperty("style"))for(var p in u.style)u.style.hasOwnProperty(p)&&(a.style[p]=u.style[p]);if(u.hasOwnProperty("events")&&u.events)for(s in u.events)a.addEventListener(s,function(t){return t.preventDefault(),u.events[s]({event:t,element:a,item:e,value:h,field:u})},!1);r.appendChild(a)},o=0;o<i.length;o++){var s;a()}return this.getOptions("procRow")?this.getOptions("procRow")(r,e):r}},{key:"refreshBody",value:function(){var e=this.findBody();if(e){this.clearBody(),this.checkFiltered();for(var t=0,n=this.getPager().pageSize*(this.getPager().pageNumber+1),r=t;r<Math.min(n,this.getWorking("filteredData").length);r++)e.appendChild(this.renderRow(this.getWorking("filteredData")[r]))}}},{key:"findBody",value:function(){return this.getOptions("targetEl").querySelector("tbody")}},{key:"clearBody",value:function(){var e=this.findBody();e&&(e.innerHTML="")}},{key:"checkFiltered",value:function(){Array.isArray(this.getWorking("filteredData"))||this.setWorking("filteredData",[])}},{key:"renderBody",value:function(){this.getOptions("onePager")||this.clearBody(),this.checkFiltered();for(var e=this.getPager().pageSize*this.getPager().pageNumber,t=this.getPager().pageSize*(this.getPager().pageNumber+1),n=this.findBody(),r=e;r<Math.min(t,this.getWorking("filteredData").length);r++)n.appendChild(this.renderRow(this.getWorking("filteredData")[r]))}},{key:"getCachedRowsCount",value:function(){return this.getData("pagination.totalRowsCount",0)}},{key:"getRowsCount",value:function(){var e=this,t=this.getOptions("interface")({}).setFilter(this.getFilter());return t["$"+at]().then(function(t){e.updatePagination(t.count)})["catch"](function(e){y.error(e)})}},{key:"updatePagination",value:function(e){var t,n=(this.getPager().pageNumber-nt)*this.getPager().pageSize+1,r=e%this.getPager().pageSize?Math.floor(e/this.getPager().pageSize)+1:Math.round(e/this.getPager().pageSize),i=[];this.setData("pagination.items.count",e),this.setData("pagination.items.from",n),this.setData("pagination.items.count",Math.min(n+this.getPager().pageSize,e)),this.setData("pagination.pages.count",r),this.setData("pagination.pages.from",Math.max(nt,this.getPager().pageNumber-rt)),this.setData("pagination.pages.to",Math.min(r,this.getPager().pageNumber+rt)),this.setData("pagination.pages.current",this.getPager().pageNumber),this.getData("pagination.pages.list").splice(0,this.getData("pagination.pages.list").length);for(var a=this.getData("pagination.pages.from");a<this.getData("pagination.pages.to");a++)i.push({index:a});(t=this.getData("pagination.pages.list")).push.apply(t,i)}},{key:"testDataItem",value:function(e){var t=this.getFilterSearch().toLowerCase();for(var n in e){var r=e[n].toString().toLowerCase();if(r.indexOf(t)>-1)return!0}return!1}},{key:"initAutoloader",value:function(){if(jQuery&&jQuery.scrollSpy&&!this.getWorking("live")&&this.getOptions("liveLoad")&&this.getOptions("onePager")&&this.getOptions("footerQuery")){var e=$(this.getOptions("footerQuery"));e&&(e.on("scrollSpy:enter",this.loadNext.bind(this)),e.scrollSpy(),this.setWorking("live",!0))}}}]),t}(C),lt=50,ht="list",pt=function(e){function t(e,n){var r;s(this,t);var i=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.app));return i.parent=e,i.setOptions("params",n),y.log("CRUD List"),i.setViews({"default":{name:i.parent.getOptions("views.list.name")||ht,common:i.parent.getOptions("views.list.common")||!0,targetQuery:e.getOptions("views.list.containerSelector")||i.parent.getOptions("containerSelector"),helpers:{}}}),i.preloadLib(i.parent.getOptions("views.list.preload")).then(i.renderWrapper.bind(i)).then(i.updateDatatable.bind(i)).then(function(){i.trigger("afterRender")})["catch"](y.report),r=i,h(i,r)}return l(t,e),u(t,[{key:"renderWrapper",value:function(){var e=this;return this.render("default",{},{title:this.parent.getOptions("names.plural"),showAddForm:function(){e.parent.app.getWorking("router").navigate([e.parent.getModuleName(),"create"].join("/"))},linkBackToList:this.parent.linkBackToList.bind(this.parent)})}},{key:"updateDatatable",value:function(){var e=this;return new Promise(function(t,n){try{e.tableView=new ut({options:{fields:e.parent.getOptions("views.list.fields"),targetEl:document.querySelector(e.parent.getOptions("views.list.targetQuery")||e.parent.getOptions("targetQuery")),helpers:y.extend({title:e.parent.getOptions("names.plural")},e.parent.getOptions("views.list.helpers")||{}),pageSize:e.app.getOptions("pager.size")||lt,pageNumber:0,onePager:!0,liveLoad:!0,footerQuery:e.parent.getOptions("views.list.footerQuery"),"interface":e.make[e.parent.getModuleName()]},events:[["afterRender",t]]})}catch(r){n(r)}})}},{key:"showNextPage",value:function(){this.tableView&&this.tableView.loadNext()}}]),t}(He),ct="getRaw",gt="update",ft="edit",dt=function(e){function t(e,n){var r;s(this,t);var i=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.app));return i.parent=e,i.setOptions("params",n),y.log("CRUD Update"),i.setViews({"default":{name:i.parent.getOptions("views.update.name")||ft,common:i.parent.getOptions("views.update.common")||!0,targetQuery:i.parent.getOptions("views.update.containerSelector")||i.parent.getOptions("containerSelector"),helpers:{}}}),i.preloadLib(i.parent.getOptions("views.update.preload")).then(i.loadItem.bind(i)).then(i.setData.bind(i)).then(i.renderWrapper.bind(i)).then(i.renderForm.bind(i)).then(function(){i.trigger("afterRender")})["catch"](y.report),r=i,h(i,r)}return l(t,e),u(t,[{key:"loadItem",value:function(){return this.make[this.parent.getModuleName()]({_id:this.getOptions("params.0")})["$"+(this.parent.getOptions("views.update.loadAction")||ct)]()}},{key:"renderWrapper",value:function(){return this.render("default",this.getData(),{})}},{key:"renderForm",value:function(){var e=this;return new Promise(function(t,n){try{e.form=new Ge({data:e.getData(),options:{action:e.parent.getOptions("views.update.action")||gt,targetQuery:e.parent.getOptions("views.update.targetQuery")||e.parent.getOptions("targetQuery"),prefix:e.parent.getOptions("views.update.prefix")||e.parent.getOptions("prefix"),role:e.parent.getOptions("views.update.role")||e.parent.getOptions("role"),data:e.getData(),helpers:y.extend({file:function(t){var n=t.e.target.files||t.e.dataTransfer.files;y.log("file changed",n),t.helpers.field.name&&n&&e.queeUpload(t.helpers.field.name,n)},submit:function(t){y.log("submit form ",t.item),e.execUploads(t.item).then(e.update.bind(e))},libs:e.getOptions("libs"),afterSubmit:e.parent.backToList.bind(e.parent)},e.parent.getOptions("views.update.helpers")||{})},events:[[["afterRestore","afterSubmit"],e.parent.backToList.bind(e.parent)],["afterRender",t]]})}catch(r){n(r)}})}},{key:"update",value:function(e){var t=this;e["$"+(this.parent.getOptions("views.update.action")||gt)]().then(function(e){y.log("form saved",e),t.parent.app.getWorking("router").navigate(t.getModuleName()),t.parent.runList()})["catch"](function(e){y.error("form not saved",e)})}}]),t}(He),vt="delete",yt=function(e){function t(e,n){var r;s(this,t);var i=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.app));return i.parent=e,i.setOptions("params",n),y.log("CRUD Delete"),i.preloadLib(i.parent.getOptions("views.delete.preload")).then(function(){confirm("Удалить запись?")?i["delete"]():i.parent.backToList()}),r=i,h(i,r)}return l(t,e),u(t,[{key:"delete",value:function(){var e="$"+(this.parent.getOptions("views.delete.action")||vt);this.make[this.parent.getModuleName()]({_id:this.getOptions("params.0")})[e]().then(this.parent.backToList.bind(this.parent))["catch"](y.report)}}]),t}(He),mt="details_",kt="default",Ot="Details default title",bt={},Pt=["options","manifest","app"],wt=function(e){function t(e){var n;s(this,t);var r=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.getOptions("prefix")||r.setOptions("prefix",mt),r.setWorking("components",[]),r.getData().isRecord||r.setData(new me({},r.getData())),r.render(),n=r,h(r,n)}return l(t,e),u(t,[{key:"getManifest",value:function(){return this.getData().getManifest()}},{key:"getActionData",value:function(){var e=this.getManifest();return e&&e.actions&&e.actions.hasOwnProperty(this.getOptions("action"))?e.actions[this.getOptions("action")]:null}},{key:"getFieldsList",value:function(){var e=this.getActionData(),t=[],n=this.getOptions("role",kt);return e&&e.fields&&e.fields.hasOwnProperty(n)&&(t=e.fields[n]),t}},{key:"render",value:function(){this.renderWrapper()}},{key:"getPartTemplateName",value:function(e){return this.getOptions("prefix")+e}},{key:"renderWrapper",value:function(){if(this.getWorking("wrapper"))this.getWorking("wrapper").update();else{var e={data:this.getWrapperData(),template:{name:this.getPartTemplateName("wrapper")},options:{helpers:this.getOptions("helpers"),targetEl:this.getOptions("targetEl"),targetQuery:this.getOptions("targetQuery"),id:this.getOptions("id")},events:[[["afterRender","afterUpdate"],this.renderComponents.bind(this)]]},t=new _e(e);this.setWorking("wrapper",t)}}},{key:"getWrapperData",value:function(){var e=this.getActionData();return{title:e.title?e.title:Ot}}},{key:"renderComponents",value:function(){if(this.getWorking("components")&&this.getWorking("components").length)for(var e=0;e<this.getWorking("components").length;e++)this.getWorking("components")[e].component.update();else for(var t=0;t<this.getFieldsList().length;t++){var n=this.getFieldsList()[t];this.addFieldComponent(n)}}},{key:"clearFieldsComponents",value:function(){for(var e=this.getWorking("components");e.length>0;)e[0].component.destroy(),e.splice(0,1)}},{key:"getFieldsLibs",value:function(){var e={options:{},manifest:{},app:{}};return this.getOptions("fields")&&(e.options=this.getOptions("fields")),y.getApp()&&y.getApp().getOptions("fields")&&(e.app=y.getApp().getOptions("fields")),this.getData().isRecord&&this.getData().getManifest()&&(e.manifest=this.getData().getManifest().fields),e}},{key:"getFieldsDefinition",value:function(e){var t=bt,n=this.getFieldsLibs(),r=!0,i=!1,a=void 0;try{for(var o,s=Pt[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var u=o.value;if(n.hasOwnProperty(u)&&n[u].hasOwnProperty(e))return n[u][e]}}catch(l){i=!0,a=l}finally{try{!r&&s["return"]&&s["return"]()}finally{if(i)throw a}}return t}},{key:"addFieldComponent",value:function(e){var t=this.getFieldsDefinition(e),n=null;n=t.component?this.castCustom(e,t):this.castCommon(e,t),this.getWorking("components").push(n)}},{key:"castCustom",value:function(e,t){var n=this,r=y.get("components")[t.component],i={field:{name:e,title:t.label||t.placeholder,type:t.type,label:t.label,array:t.array,"default":t["default"],placeholder:t.placeholder,options:this.getOptions(E.join("helpers","libs",e))}},a=y.extend({isChecked:function(t){return t.item.value===n.getData(e)},field:i.field,data:this.getData()},this.getOptions("helpers"));return i.component=new r({data:this.getData(),options:{helpers:a,targetEl:this.getTargetElement(t.target),renderAnd:"placeLast"}}),i}},{key:"castCommon",value:function(e,t){var n=this,r={field:{name:e,title:t.label||t.placeholder,type:t.type,label:t.label,array:t.array,"default":t["default"],placeholder:t.placeholder,options:this.getOptions(E.join("helpers","libs",e))}},i=y.extend({isChecked:function(t){return t.item.value===n.getData(e)},field:r.field,data:this.getData()},this.getOptions("helpers"));return r.component=new _e({data:this.getData(),template:{name:this.getPartTemplateName(t.type)},options:{helpers:i,targetEl:this.getTargetElement(t.target),renderAnd:"placeLast"}}),r}},{key:"getTargetElement",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"body";e||(e="body");var t=this.getOptions("targetEl").querySelector('[role="'+e+'"]');return t||"body"===e||(e="body",t=this.getOptions("targetEl").querySelector('[role="'+e+'"]')),t||"body"!=e?t:this.getOptions("targetEl")}},{key:"updateField",value:function(e){for(var t=0;t<this.getWorking("components").length;t++)this.getWorking("components")[t].field.name===e&&this.getWorking("components")[t].component.update()}},{key:"update",value:function(){for(var e=0;e<this.getWorking("components").length;e++)this.getWorking("components")[e].component.update()}}]),t}(C),St="get",Rt="details",Et=function(e){function t(e,n){var r;s(this,t);var i=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.app));return i.parent=e,i.setOptions("params",n),y.log("CRUD Details"),i.setViews({"default":{name:i.parent.getOptions("views.details.name")||Rt,common:i.parent.getOptions("views.details.common")||!0,targetQuery:i.parent.getOptions("views.details.containerSelector")||i.parent.getOptions("containerSelector"),helpers:{}}}),i.preloadLib(i.parent.getOptions("views.details.preload")).then(i.loadItem.bind(i)).then(i.setData.bind(i)).then(i.renderWrapper.bind(i)).then(i.renderDetails.bind(i)).then(function(){i.trigger("afterRender")})["catch"](y.report),r=i,h(i,r)}return l(t,e),u(t,[{key:"loadItem",value:function(){return this.make[this.parent.getModuleName()]({_id:this.getOptions("params.0")})["$"+(this.parent.getOptions("views.details.action")||St)]()}},{key:"renderWrapper",value:function(){var e=this,t=this.getData(),n={ID:t?t[this.parent.getModuleName()+"ID"]:"",field:{array:!1},update:function(t){e.app.getWorking("router").navigate([e.parent.getModuleName(),t.item._id,"update"].join("/"))},"delete":function(t){e.app.getWorking("router").navigate([e.parent.getModuleName(),t.item._id,"delete"].join("/"))},linkBackToList:this.parent.linkBackToList.bind(this.parent),title:this.parent.getOptions("names.single")};return this.render("default",t,n)}},{key:"renderDetails",value:function(){var e=this,t=this.getData();return new Promise(function(n,r){try{new wt({data:t,options:{targetQuery:e.parent.getOptions("views.details.targetQuery"),targetEl:document.querySelector(e.parent.getOptions("views.details.targetQuery")||e.parent.getOptions("targetQuery")),action:e.parent.getOptions("views.details.action")||St,prefix:e.parent.getOptions("views.details.prefix")||e.parent.getOptions("prefix"),role:e.parent.getOptions("views.details.role")||e.parent.getOptions("role"),helpers:y.extend({linkBackToList:e.parent.linkBackToList(),libs:e.getOptions("lib"),ID:t[e.parent.getModuleName()+"ID"],__version:t.__version},e.parent.getOptions("views.details.helpers")||{})},events:[["afterRender",n]]})}catch(i){r(i)}})}}]),t}(He),Dt=function(e){function t(e,n){var r;s(this,t),y.log("running CRUDController");var i=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.setOptions("names",{plural:"plural",single:"single"}),i.setOptions("params",n),i.setOptions("containerSelector",i.app.getOptions("crud.containerSelector")),r=i,h(i,r)}return l(t,e),u(t,[{key:"route",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(1==e.length)return"create"===e[0]?this.runCreate(e):this.runDetails(e);if(2==e.length){if("delete"===e[1])return this.runDelete(e);if("update"===e[1])return this.runUpdate(e);var t="run"+y.capitalizeFirstLetter(e[0]);if(this[t]&&"function"==typeof this[t])return this[t](e)}return this.runList(e)}},{key:"runCreate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.view=new et(this,e).on("afterRender",this.onAfterRender.bind(this)),this}},{key:"runList",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.view=new pt(this,e).on("afterRender",this.onAfterRender.bind(this)),this}},{key:"runDetails",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.view=new Et(this,e).on("afterRender",this.onAfterRender.bind(this)),this}},{key:"runDelete",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.view=new yt(this,e).on("afterRender",this.onAfterRender.bind(this)),this}},{key:"runUpdate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.view=new dt(this,e).on("afterRender",this.onAfterRender.bind(this)),this}},{key:"onAfterRender",value:function(){this.trigger("afterRender")}},{key:"backToList",value:function(){this.app.getWorking("router").navigate(this.getModuleName())}},{key:"linkBackToList",value:function(){return this.getModuleName()}}]),t}(He),Wt={content:function(e,t,n){e.attributeResult=E.parseSubs(e.attributeExpression,t,n),e.params.indexOf("capitalize")>-1&&(e.attributeResult=e.attributeResult.toUpperCase()),e.element.textContent=e.attributeResult},bind:function(e,t,n){e.element.binds&&e.element.binds.hasOwnProperty(e.params[0])&&e.element.binds[e.params[0]].indexOf(e.attributeExpression)>-1||(e.element.addEventListener(e.params[0],function(r){return 1!==e.params.length&&"default"===e.params[1]||r.preventDefault(),e.attributeResult?e.attributeResult({scope:e,item:t,helpers:n,e:r}):!0},!1),e.element.hasOwnProperty("binds")||(e.element.binds={}),e.element.binds.hasOwnProperty(e.params[0])||(e.element.binds[e.params[0]]=[]),-1===e.element.binds[e.params[0]].indexOf(e.attributeExpression)&&e.element.binds[e.params[0]].push(e.attributeExpression))},value:function(e,t,n){var r=["change","keyup"],i=function(){if(["checkbox","radio","select-multiple"].indexOf(e.element.type)>-1)switch(e.element.type){case"checkbox":E.set(e.attributeExpression,t,n,e.element.checked);break;case"radio":E.set(n.field.name,n.data,n,e.element.checked?e.element.value:null);break;case"select-multiple":var r=[].slice.call(e.element.selectedOptions).map(function(e){return e.value});E.set(e.attributeExpression,t,n,r)}else E.set(e.attributeExpression,t,n,e.element.value)};if(e.element.setAttribute("value",E.get(e.attributeExpression,t,n)),e.element.processedValue!==!0){"textarea"===e.element.type&&(e.element.innerHTML=E.get(e.attributeExpression,t,n));var a=!0,o=!1,s=void 0;try{for(var u,l=r[Symbol.iterator]();!(a=(u=l.next()).done);a=!0){var h=u.value;e.element.addEventListener(h,i)}}catch(p){o=!0,s=p}finally{try{!a&&l["return"]&&l["return"]()}finally{if(o)throw s}}e.element.processedValue=!0}},attr:function(e,t,n){var r=E.get(e.attributeExpression,t,n)||E.parseSubs(e.attributeExpression,t,n);e.attributeResult="function"==typeof r?r({scope:e,item:t,helpers:n}):r,e.element.setAttribute(e.params[0],e.attributeResult)},name:function(e,t,n){e.element.setAttribute("name",E.get(e.attributeExpression,t,n))},change:function(){},checked:function(e,t,n){var r=E.get(e.attributeExpression,t,n);e.attributeResult="function"==typeof r?r({scope:e,item:t,helpers:n}):r,e.attributeResult?e.element.setAttribute("checked",!0):e.element.removeAttribute("checked")},"class":function(e,t,n){var r=E.get(e.attributeExpression,t,n);if(e.attributeResult="function"==typeof r?r({scope:e,item:t,helpers:n}):r,e.params.length<3||isNaN(e.attributeResult))e.attributeResult?(e.element.classList.add(e.params[0]),e.params.length>1&&e.element.classList.remove(e.params[1])):(e.element.classList.remove(e.params[0]),e.params.length>1&&e.element.classList.add(e.params[1]));else{for(var i=!1,a=0;a<e.params.length;a++)a===e.attributeResult?(e.element.classList.add(e.params[a]),i=!0):e.element.classList.remove(e.params[a]);i||e.element.classList.add(e.params[0])}},options:function(e,t,n){var r=0,i=null,a="value",o="name",s=n.hasOwnProperty("field")&&n.field.hasOwnProperty("name")?n.field.name:"value";if(e.element.innerHTML="",2===e.params.length&&(o=e.params[0],a=e.params[1]),3===e.params.length&&(o=e.params[0],a=e.params[1],s=e.params[2]),"undefined"!=typeof n&&null!==n&&n.hasOwnProperty("default")&&n["default"]&&(i=document.createElement("option"),i.setAttribute("value",""),i.textContent=n.placeholder,e.element.appendChild(i)),"undefined"!=typeof t&&null!==t){var u=E.get(e.attributeExpression,t,n);for(r=0;r<u.length;r++)i=document.createElement("option"),i.setAttribute("value",u[r][a]),i.textContent=u[r][o],n.field.array?t[s]&&Array.isArray(t[s])&&t[s].indexOf(u[r][a])>-1&&i.setAttribute("selected",!0):t[s]===u[r][a]&&i.setAttribute("selected",!0),e.element.appendChild(i)}},href:function(e,t,n){e.element.notRouterInitialized||(e.attributeResult=E.parseSubs(e.attributeExpression,t,n),e.element.setAttribute("href",I.getFullRoute(e.attributeResult)),e.element.addEventListener("click",function(r){return r.preventDefault(),I.navigate(E.parseSubs(e.attributeExpression,t,n)),!1}),e.element.notRouterInitialized=!0)},keybind:function(e,t,n){e.element.keybinds&&e.element.keybinds.hasOwnProperty(e.params.join("-"))&&e.element.keybinds[e.params.join("-")].indexOf(e.attributeExpression)>-1||(e.element.addEventListener("keyup",function(r){return e.attributeResult&&r.key.toLowerCase()===e.params[0]?e.attributeResult({scope:e,item:t,helpers:n,e:r}):!0},!1),e.element.hasOwnProperty("binds")||(e.element.keybinds={}),e.element.keybinds.hasOwnProperty(e.params.join("-"))||(e.element.keybinds[e.params.join("-")]=[]),-1===e.element.keybinds[e.params.join("-")].indexOf(e.attributeExpression)&&e.element.keybinds[e.params.join("-")].push(e.attributeExpression))}};Se.add(Wt),e.notCommon=y,e.notPath=E,e.notBase=C,e.notImage=B,e.notApp=be,e.notAPI=U,e.notController=He,e.CRUDController=Dt,e.CRUDCreate=et,e.CRUDDelete=yt,e.CRUDDetails=Et,e.CRUDList=pt,e.CRUDUpdate=dt,e.notTemplateProcessors=Se,e.notTemplateProcessorsLib=Wt,e.notTemplateCache=te,e.notRenderer=Ee,e.notComponent=_e,e.notForm=Ge,e.notRouter=I,e.notTable=ut,e.notDetails=wt,e.notRecord=me,e.notRecordInterface=fe}(this.notFramework=this.notFramework||{});
